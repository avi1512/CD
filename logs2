Push event to branch master
Connecting to https://github.intuit.com/api/v3 using github-svc-sbseg-ci
Obtained Jenkinsfile from 1636d4387e16787e32e0e643e972dddf97a934ce
Loading library msaas-shared-lib@master
Examining dev-patterns/msaas-jenkins-shared-library
Attempting to resolve master as a branch
Resolved master as branch master at revision c6c50fe6d6c7ff0f43d316429e3a96d4b1673b63
The recommended git tool is: NONE
using credential github-svc-sbseg-ci
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/_i4eappservice-deployment_master@libs/100b0a289936b5af5f1c3e729dbdff3dc4391ff53dd3074bb53a2bfd35e799d6/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.intuit.com/dev-patterns/msaas-jenkins-shared-library.git # timeout=10
Fetching without tags
Fetching upstream changes from https://github.intuit.com/dev-patterns/msaas-jenkins-shared-library.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
using GIT_ASKPASS to set credentials github-svc-sbseg-ci
 > git fetch --no-tags --force --progress -- https://github.intuit.com/dev-patterns/msaas-jenkins-shared-library.git +refs/heads/master:refs/remotes/origin/master # timeout=10
Checking out Revision c6c50fe6d6c7ff0f43d316429e3a96d4b1673b63 (master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f c6c50fe6d6c7ff0f43d316429e3a96d4b1673b63 # timeout=10
Commit message: "Merge pull request #793 from dev-patterns/revert-786-dependabot"
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-svc-sbseg-ci
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/_i4eappservice-deployment_master/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
using GIT_ASKPASS to set credentials github-svc-sbseg-ci
 > git fetch --tags --force --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/master:refs/remotes/origin/master # timeout=10
Checking out Revision 1636d4387e16787e32e0e643e972dddf97a934ce (master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D master # timeout=10
 > git checkout -b master 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
Commit message: "Merge pull request #21 from learning-learnexp/neil-prod-min-increase"
 > git rev-list --no-walk 560d4c35ec45677a905689d229d4147865e40016 # timeout=10
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] echo
Removing existing /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] sh
+ rm -f /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:15:20.471113815
+ uname -a
Linux futures-ibp-jenkins-pwx-3-0-0-56694d649-gfl8x 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ [ ! -f /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh ]
+ whoami
+ echo User root creating /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh now:
User root creating /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh now:
+ cat
+ chown -R 1000:1000 /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo Succeeded; chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
Succeeded; chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 jenkins jenkins 321 2024-04-16 01:15:20.469999929 +0000 /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ git log -1 --pretty=format:%an
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
Last commit was made by user: nhan2
[Pipeline] echo
MSaaS Service Account commit? false
[Pipeline] pwd
[Pipeline] httpRequest
HttpMethod: GET
URL: https://github.intuit.com/api/v3/repos/learning-learnexp/i4eappservice/contents/msaas-config.yaml
Accept: application/vnd.github.v3.raw
Using authentication: github-svc-sbseg-ci
Sending request to url: https://github.intuit.com/api/v3/repos/learning-learnexp/i4eappservice/contents/msaas-config.yaml
Response Code: HTTP/1.1 200 OK
Success: Status code 200 is in the accepted range: 100:399
Saving response body to /var/jenkins_home/workspace/_i4eappservice-deployment_master/msaas-config.yaml
[Pipeline] readYaml
[Pipeline] pwd
[Pipeline] httpRequest
HttpMethod: GET
URL: https://github.intuit.com/api/v3/repos/learning-learnexp/i4eappservice/contents/KubernetesPods.yaml
Accept: application/vnd.github.v3.raw
Using authentication: github-svc-sbseg-ci
Sending request to url: https://github.intuit.com/api/v3/repos/learning-learnexp/i4eappservice/contents/KubernetesPods.yaml
Response Code: HTTP/1.1 200 OK
Success: Status code 200 is in the accepted range: 100:399
Saving response body to /var/jenkins_home/workspace/_i4eappservice-deployment_master/KubernetesPods.yaml
[Pipeline] fileExists
[Pipeline] readFile
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:15:21.778997061
+ uname -a
Linux futures-ibp-jenkins-pwx-3-0-0-56694d649-gfl8x 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ [ ! -f /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh ]
+ whoami
+ echo User root found /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
User root found /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo Succeeded; chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
Succeeded; chmod +x /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 jenkins jenkins 321 2024-04-16 01:15:20.469999929 +0000 /var/jenkins_home/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ git remote show origin
+ sed -n /HEAD branch/s/.*: //p
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
defaultBranch in config: null
[Pipeline] echo
defaultBranch from git:  master
[Pipeline] echo
setupMsaasDeploymentPipeline: debug=null verbose=null preprodOnly=false environments=[qal-usw2-eks, e2e-usw2-eks, stg-usw2-eks, prd-usw2-eks, prf-usw2-eks]
[Pipeline] echo
setupMsaasDeploymentPipeline Completed Successfully
[Pipeline] echo
{"eventType":"method_invocation","library_method":"setupMsaasDeploymentPipeline","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"3707","timeStamp":"1713230122744","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":""}
[Pipeline] }
[Pipeline] // node
[Pipeline] echo
{"eventType":"method_invocation","library_method":"isOnlyMSaaSServiceUser","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"1","timeStamp":"1713230122816","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
{"eventType":"method_invocation","library_method":"getEnv","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"6","timeStamp":"1713230122919","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
{"eventType":"method_invocation","library_method":"getEnv","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"1","timeStamp":"1713230122946","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
{"eventType":"method_invocation","library_method":"getEnv","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"1","timeStamp":"1713230122971","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
{"eventType":"method_invocation","library_method":"getEnv","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"1","timeStamp":"1713230122996","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
Using 'prd-usw2-eks' as 'primary'
[Pipeline] echo
{"eventType":"method_invocation","library_method":"getEnv","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"null","build":"725","exception":"0","exceptionMessage":"","duration":"25","timeStamp":"1713230123045","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] echo
[WARNING] label option is deprecated. To use a static pod template, use the 'inheritFrom' option.
[Pipeline] podTemplate
[Pipeline] {
[Pipeline] node
Created Pod: kubernetes futures-ibp-jenkins/futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5
Agent futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 is provisioned from template futures_lea-lea-i4e-dep-master-v1.725-p1ksr
---
apiVersion: "v1"
kind: "Pod"
metadata:
  annotations:
    iam.amazonaws.com/role: "arn:aws:iam::733536204770:role/futures-prd-jenkins"
    buildUrl: "http://futures-ibp-jenkins:8080/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/"
    runUrl: "job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/"
  labels:
    jenkins: "slave"
    jenkins/label-digest: "ef0232ebcc3187d64a451777d93849f86919dacb"
    jenkins/label: "futures_lea-lea-i4e-dep-master-v1.725"
  name: "futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5"
  namespace: "futures-ibp-jenkins"
spec:
  containers:
  - command:
    - "cat"
    image: "docker.intuit.com/oicp/standard/podman:latest"
    imagePullPolicy: "Always"
    name: "podman"
    resources:
      limits:
        github.com/fuse: "1"
    securityContext:
      capabilities:
        add:
        - "SYS_ADMIN"
        - "SYS_RESOURCE"
    tty: true
    volumeMounts:
    - mountPath: "/var/lib/containers"
      name: "container-storage"
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "docker.intuit.com/oicp/standard/cpd2:1"
    imagePullPolicy: "Always"
    name: "cpd2"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - args:
    - "$(JENKINS_SECRET)"
    - "$(JENKINS_AGENT_NAME)"
    - "-url"
    - "$(JENKINS_URL)"
    env:
    - name: "JENKINS_SECRET"
      value: "********"
    - name: "JENKINS_TUNNEL"
      value: "futures-ibp-jenkins-agent-pwx-3-0-0:50000"
    - name: "JENKINS_AGENT_NAME"
      value: "futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5"
    - name: "JENKINS_NAME"
      value: "futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5"
    - name: "JENKINS_AGENT_WORKDIR"
      value: "/home/jenkins/agent"
    - name: "JENKINS_URL"
      value: "http://futures-ibp-jenkins:8080/futures/"
    image: "docker.intuit.com/dev/build/ibp/jnlp-slave-with-docker:3.36-2_master_85"
    name: "jnlp"
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "docker.intuit.com/dev/deploy/cd/argocd-utils:stable"
    imagePullPolicy: "Always"
    name: "cdtools"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "docker.intuit.com/coe/servicenow-cr-agent/service/servicenow-cr-agent:latest"
    imagePullPolicy: "Always"
    name: "servicenow"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "docker.intuit.com/oicp/standard/external/maven:3.6-amazoncorretto-11"
    imagePullPolicy: "Always"
    name: "test"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "docker.intuit.com/dev/build/ibp/api-tools-container:latest"
    imagePullPolicy: "Always"
    name: "api-tools-container"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  nodeSelector:
    kubernetes.io/os: "linux"
  restartPolicy: "Never"
  volumes:
  - emptyDir: {}
    name: "container-storage"
  - emptyDir:
      medium: ""
    name: "workspace-volume"

Running on futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-svc-sbseg-ci
Cloning the remote Git repository
Honoring refspec on initial clone
Cloning repository https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git init /home/jenkins/agent/workspace/_i4eappservice-deployment_master # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-svc-sbseg-ci
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/master:refs/remotes/origin/master # timeout=10
Avoid second fetch
Checking out Revision 1636d4387e16787e32e0e643e972dddf97a934ce (master)
Commit message: "Merge pull request #21 from learning-learnexp/neil-prod-min-increase"
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/master:refs/remotes/origin/master # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
[Pipeline] { (qal-usw2-eks)
[Pipeline] lock
Trying to acquire lock on [learning-learnexp-i4eappservice-usw2-qal]
Resource [learning-learnexp-i4eappservice-usw2-qal] did not exist. Created.
Lock acquired on [learning-learnexp-i4eappservice-usw2-qal]
[Pipeline] {
[Pipeline] timeout
Timeout set to expire in 22 min
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] container
[Pipeline] {
[Pipeline] echo
FYI for restarting: version=null image_full_name=null restart_from_build=725 restart_chkpt_time=2024-04-16 01:15:35 (local)
[Pipeline] writeYaml
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
Archived 'msaasConfig' in artifact: msaas-config_restart-archive.yaml
[Pipeline] lock
Trying to acquire lock on [2597468678172884775-deploy]
Resource [2597468678172884775-deploy] did not exist. Created.
Lock acquired on [2597468678172884775-deploy]
[Pipeline] {
[Pipeline] echo
Manifests not pre-rendered. Rendering now.
[Pipeline] lock
Trying to acquire lock on [2597468678172884775-manifests-all]
Resource [2597468678172884775-manifests-all] did not exist. Created.
Lock acquired on [2597468678172884775-manifests-all]
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:15:37.005109909
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root creating /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh now:'
User root creating /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh now:
+ cat
+ chown -R 1000:1000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-****
Warning: JENKINS-30600: special launcher org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator$1@6afb9a0; decorates RemoteLauncher[hudson.remoting.Channel@49b3daf0:JNLP4-connect connection from ip-10-47-6-247.us-west-2.compute.internal/10.47.6.247:43022] will be ignored (a typical symptom is the Git executable not being run inside a designated container)
Cloning the remote Git repository
Avoid second fetch
Checking out Revision 1636d4387e16787e32e0e643e972dddf97a934ce (refs/remotes/origin/master)
Commit message: "Merge pull request #21 from learning-learnexp/neil-prod-min-increase"
[Pipeline] sh
Cloning repository https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git init /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-****
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
++ git config --global user.email
+ result=
+ true
[Pipeline] sh
++ git config --global user.name
+ result=
+ true
[Pipeline] lock
Trying to acquire lock on [git.config.lock-i4eappservice]
Resource [git.config.lock-i4eappservice] did not exist. Created.
Lock acquired on [git.config.lock-i4eappservice]
[Pipeline] {
[Pipeline] sh
+ git config --global user.email MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
[Pipeline] sh
+ git config --global user.name MSaaSServiceAccount
[Pipeline] }
Lock released on resource [git.config.lock-i4eappservice]
[Pipeline] // lock
[Pipeline] echo
render manifest with environments
[Pipeline] echo
renderManifest 'config.convertDisable=false' and 'config.convertManifestOverride=true'
[Pipeline] echo
Disabling integration test as config.enableIntegrationTest is not true. To enable, set this flag to true.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/qal-usw2-eks
[Pipeline] {
[Pipeline] fileExists
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] sh
+ rm -f IntegrationTest.yaml
[Pipeline] sh
+ rm kustomization.yaml
[Pipeline] writeYaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] fileExists
[Pipeline] sh
+ grep '\- https://github.intuit.com/dev-patterns/intuit-kustomize'
+ awk '-F ' '{print $2;}'
+ sed 's/kustomize\/\///g'
+ sed 's/\?ref=/:/g'
+ cat app-base/kustomization.yaml
+ grep -E -o 'kustomize\/\/(.*?)\?ref=v([0-9]+\.[0-9]+\.\S+?)'
[Pipeline] readYaml
[Pipeline] sh
+ awk -v envPath=environments/qal-usw2-eks -v assetId=2597468678172884775 -v assetAlias=Intuit.learning.learnexp.i4eappservice -v serviceName=i4eappservice -F: '{print "Intuit-kustomize, environment:"envPath", assetId:"assetId", assetAlias:"assetAlias", serviceName:"serviceName", base:"$1", version:"$2"";}'
+ echo 'intuit-metrics-service-base:v6.0.0
intuit-service-rollout-hpa-base:v6.0.0
intuit-service-rollout-canary-base:v6.0.0
intuit-service-rollout-ingress-base:v6.0.0
'
Intuit-kustomize, environment:environments/qal-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-metrics-service-base, version:v6.0.0
Intuit-kustomize, environment:environments/qal-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-hpa-base, version:v6.0.0
Intuit-kustomize, environment:environments/qal-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-canary-base, version:v6.0.0
Intuit-kustomize, environment:environments/qal-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-ingress-base, version:v6.0.0
Intuit-kustomize, environment:environments/qal-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:, version:
[Pipeline] echo
Trying to use vanilla kustomize: /usr/local/bin/kustomize-v4.5.5
[Pipeline] sh
+ /usr/local/bin/kustomize-v4.5.5 build environments/qal-usw2-eks
2024/04/16 01:15:47 well-defined vars that were never replaced: SELECTOR,IMAGE_URL
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-qal
    eks.amazonaws.com/sts-regional-endpoints: "true"
  name: workflow-service-account
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: workflow-role
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - watch
  - patch
- apiGroups:
  - ""
  resources:
  - pods/log
  verbs:
  - get
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: workflow-role-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: workflow-role
subjects:
- kind: ServiceAccount
  name: workflow-service-account
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-desired-service
spec:
  ports:
  - name: jacoco-agent
    port: 6300
    targetPort: 6300
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-root-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    iks-metric: actuator-prometheus
    mesh-metrics: mesh-envoy-prometheus
  name: i4eappservice-service-metrics
spec:
  ports:
  - name: iks-metric
    port: 8490
    targetPort: 8490
  selector:
    app: i4eappservice
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-stable-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: jacoco-server
  name: jacoco-server-service
spec:
  ports:
  - name: jacoco-port
    port: 443
    targetPort: 8443
  selector:
    app: jacoco-server
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: jacoco-server
  name: jacoco-server-deployment
spec:
  selector:
    matchLabels:
      app: jacoco-server
  template:
    metadata:
      annotations:
        iam.amazonaws.com/role: k8s-learning-learnexp-i4eappservice-qal-usw2-eks
      labels:
        app: jacoco-server
    spec:
      containers:
      - env:
        - name: SPRING_PROFILE
          value: prdssl
        image: docker.intuit.com/dev/integration/cg-sre-services/service/jacoco:0.1.2
        name: app
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: i4eappservice-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: i4eappservice
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-cpu-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: cpu-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: cpu-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_cpu_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.cpu-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-error-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: error-rate-limit-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: error-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_errors_5xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
          OR on() vector(0)
    successCondition: result[0] <= {{args.error-rate-limit-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-memory-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: memory-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: memory-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_memory_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.memory-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-pod-restarts
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: pod-restarts
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          sum(
          sum_over_time(kube_pod_container_status_restarts_total{namespace="{{args.namespace}}",pod=~".*-{{args.canary-hash}}-.*"}[5m])
          )
    successCondition: result[0] == 0
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-request-latency
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: request-latency-limit-msec
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: request-latency
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.95, quantile_over_time(0.95, namespace_pod_http_server_requests_latency{namespace="{{args.namespace}}",
          rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))*1000)
    successCondition: 'len(result) > 0? result[0] < {{args.request-latency-limit-msec}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
    successCondition: 'len(result) > 0? result[0] >= {{args.success-rate-min-percentage}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate-include4xx
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-include4xx-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate-excld4xx
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: "(sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace=\"{{args.namespace}}\",
          rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])) + sum(sum_over_time(namespace_pod_http_server_requests_errors_4xx{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])))
          \n/ \nsum(sum_over_time(namespace_pod_http_server_requests_count{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m]))
          * 100"
    successCondition: result[0] >= {{args.success-rate-include4xx-min-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  labels:
    app: i4eappservice
    appType: spring-boot
    assetAlias: Intuit.learning.learnexp.i4eappservice
    assetId: "2597468678172884775"
    buildType: maven
    env: qal-usw2-eks
    l1: learning
    l2: learnexp
  name: i4eappservice-rollout
spec:
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: i4eappservice
  strategy:
    canary:
      canaryMetadata:
        annotations:
          role: canary
        labels:
          role: canary
      canaryService: i4eappservice-desired-service
      maxSurge: 25%
      maxUnavailable: 0%
      stableMetadata:
        annotations:
          role: stable
        labels:
          role: stable
      stableService: i4eappservice-stable-service
  template:
    metadata:
      annotations:
        admiral.io/env: qal
        alpha.istio.io/identity: Intuit.learning.learnexp.i4eappservice
        iam.amazonaws.com/role: disabled
        policyId: p-w9ry686g2frm
        sidecar.istio.io/inject: "true"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: 169.254.169.254/32
        traffic.sidecar.istio.io/excludeOutboundPorts: 3306,3308,61617,443
        traffic.sidecar.istio.io/includeInboundPorts: "8090"
      labels:
        app: i4eappservice
        assetAlias: Intuit.learning.learnexp.i4eappservice
        assetId: "2597468678172884775"
        env: qal-usw2-eks
        istio-injected: "true"
        l1: learning
        l2: learnexp
    spec:
      containers:
      - env:
        - name: MESH_ENABLED
          value: "true"
        - name: MESH_SIDECAR_PORT
          value: "15000"
        - name: MESH_TRAFFIC_PORT
          value: "8090"
        - name: APP_ENV
          value: qal
        - name: APP_DATABASE_HOST
          value: qaldbcluster-ch6jk7ejye6p.cluster-cqrg5qvpneyz.us-west-2.docdb.amazonaws.com
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        - name: L1
          value: learning
        - name: L2
          value: learnexp
        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
        name: app
        ports:
        - containerPort: 8443
          name: service
        - containerPort: 8490
          name: metrics
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health/full
            port: 8443
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 5
          successThreshold: 2
          timeoutSeconds: 2
        resources:
          limits:
            cpu: 700m
            memory: 3Gi
          requests:
            cpu: 700m
            memory: 3Gi
      initContainers:
      - env:
        - name: APP_ENV
          value: qal
        - name: SEGMENT_CLUSTER_ROLE_ARN
          value: arn:aws:iam::000767522314:role/shared.futures-ppd-usw2-k8s
        - name: SEGMENT_IDPS_APPLIANCE
          value: MSaaSBU01-PRODUCTION-PSIQSZ.pd.idps.a.intuit.com
        - name: SEGMENT_IDPS_POLICY_ID
          value: p-id871oygoxoe
        - name: AWS_SDK_LOAD_CONFIG
          value: "1"
        - name: AWS_ROLE_SESSION_NAME
          value: kiam-kiam
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        image: docker.intuit.com/dev/containers/segment-app-init/service/segment-app-init:1.1
        name: segment-app-init
---
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-hpa
spec:
  behavior:
    scaleDown:
      policies:
      - periodSeconds: 60
        type: Percent
        value: 10
      selectPolicy: Min
      stabilizationWindowSeconds: 300
    scaleUp:
      policies:
      - periodSeconds: 15
        type: Percent
        value: 40
      - periodSeconds: 15
        type: Pods
        value: 2
      selectPolicy: Max
      stabilizationWindowSeconds: 0
  maxReplicas: 10
  metrics:
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_pod_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_container_app_ready_only_avg_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  minReplicas: 1
  scaleTargetRef:
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    name: i4eappservice-rollout
---
apiVersion: iammanager.keikoproj.io/v1alpha1
kind: Iamrole
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
    iam.amazonaws.com/irsa-service-account: default,workflow-service-account
  name: iamrole
spec:
  PolicyDocument:
    Statement:
    - Action:
      - ec2:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - iam:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - sts:AssumeRole
      Effect: Allow
      Resource:
      - arn:aws:iam::013156140003:role/pipeline-s3-role-ppd-us-west-2
      - arn:aws:iam::164507085864:role/qal-i4e-app-access-aws-role
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol: HTTPS
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:000767522314:certificate/7f801c70-ced0-4832-9c47-937d0d656dc6
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-path: /health/full
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=false
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/security-groups: iks-intuit-cidr-ingress-tcp-443,iks-intuit-api-gw-ingress-preprod-tcp-443,iks-intuit-app-alb-custom-ingress,iks-intuit-ibp-ingress-tcp-443
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/target-type: ip
    argocd.argoproj.io/sync-wave: "-1"
    external-dns.alpha.kubernetes.io/hostname: learning-qal-i4eappservice.futuresppdusw2.iks2.a.intuit.com,
      learning-qal-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com, learning-qal-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com,
      learning-qal-i4eappservice-jacoco.futuresppdusw2.iks2.a.intuit.com
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-ingress
spec:
  ingressClassName: aws-alb
  rules:
  - host: learning-qal-i4eappservice-jacoco.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: jacoco-server-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-qal-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-desired-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-qal-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-stable-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - http:
      paths:
      - backend:
          service:
            name: i4eappservice-root-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
[Pipeline] echo
Using default kustomize: kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] echo
run kustomize with environments
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:15:49.283280108
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ cd environments/qal-usw2-eks
+ /usr/local/bin/kustomize-v4.5.5 build
2024/04/16 01:15:54 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] pwd
[Pipeline] echo
renderManifest writing runKustomizeBuild output at /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml
[Pipeline] writeFile
[Pipeline] echo
Using default kustomize (cached): kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] sh
+ iconvert --version
iconvert version {"version": "v1.2.1", "gitCommit": "a029614", "buildDate": "2023-08-23T23:19:06Z"}
[Pipeline] sh
+ iconvert --kustomize /usr/local/bin/kustomize-v4.5.5 --input-file /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml --config /.convert-config.yaml --debug
time="2024-04-16T01:15:55Z" level=debug msg="using tmp directory '/tmp/iconvert1122499672'"
time="2024-04-16T01:15:55Z" level=debug msg="splitting '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml' into individual files in '/tmp/iconvert1122499672'... "
time="2024-04-16T01:15:55Z" level=info msg="Using ConfigFile @ /.convert-config.yaml"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'Ingress' with ApiVersion 'networking.k8s.io/v1'..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Ingress' with ApiVersion 'networking.k8s.io/v1' on 'Ingress-i4eappservice-rollout-ingress.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version networking.k8s.io/v1 -f /tmp/iconvert1122499672/Ingress-i4eappservice-rollout-ingress-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"loadBalancer": Map{}},

time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by provided Processor for kind: 'Ingress'"

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/Ingress-i4eappservice-rollout-ingress-copy.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'Role-workflow-role.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert1122499672/Role-workflow-role-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/Role-workflow-role-copy.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'RoleBinding-workflow-role-binding.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert1122499672/RoleBinding-workflow-role-binding-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/RoleBinding-workflow-role-binding-copy.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'RoleBinding-workflow-role-binding.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert1122499672/RoleBinding-workflow-role-binding-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by provided Processor for kind: 'RoleBinding'"

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/RoleBinding-workflow-role-binding-copy.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'PodDisruptionBudget' with ApiVersion 'policy/v1'..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'PodDisruptionBudget' with ApiVersion 'policy/v1' on 'PodDisruptionBudget-i4eappservice-pdb.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version policy/v1 -f /tmp/iconvert1122499672/PodDisruptionBudget-i4eappservice-pdb-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{
- 		"currentHealthy":     Number(0),
- 		"desiredHealthy":     Number(0),
- 		"disruptionsAllowed": Number(0),
- 		"expectedPods":       Number(0),
- 	},

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/PodDisruptionBudget-i4eappservice-pdb-copy.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2'..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2' on 'HorizontalPodAutoscaler-i4eappservice-rollout-hpa.yaml'"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version autoscaling/v2 -f /tmp/iconvert1122499672/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml"
time="2024-04-16T01:15:55Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"currentMetrics": nil, "desiredReplicas": Number(0)},

time="2024-04-16T01:15:55Z" level=debug msg="removing tmp file '/tmp/iconvert1122499672/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="updating Kind 'CronJob' with ApiVersion 'batch/v1'..."
time="2024-04-16T01:15:55Z" level=info msg="Resource 'CronJob' not found skipping ..."
time="2024-04-16T01:15:55Z" level=debug msg="running '/usr/local/bin/kustomize-v4.5.5' in '/tmp/iconvert1122499672' to unify files"
time="2024-04-16T01:15:55Z" level=debug msg="/usr/local/bin/kustomize-v4.5.5 build /tmp/iconvert1122499672"
time="2024-04-16T01:15:55Z" level=debug msg="creating temporary rendered file at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
time="2024-04-16T01:15:55Z" level=info msg="showing differences:"

apiVersion  (PodDisruptionBudget/default/i4eappservice-pdb)
  ± value change
    - policy/v1beta1
    + policy/v1

apiVersion  (HorizontalPodAutoscaler/default/i4eappservice-rollout-hpa)
  ± value change
    - autoscaling/v2beta2
    + autoscaling/v2

time="2024-04-16T01:15:55Z" level=debug msg="removing temporary rendered file generated at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] echo
renderManifest returning iconvert output
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/qal-usw2-eks
[Pipeline] {
[Pipeline] echo
Integration test disabled. Resetting files.
[Pipeline] echo
Resetting integration test file IntegrationTest.yaml
[Pipeline] sh
+ git restore IntegrationTest.yaml
[Pipeline] echo
Resetting integration test file kustomization.yaml
[Pipeline] sh
+ git restore kustomization.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] echo
render manifest with environments
[Pipeline] echo
renderManifest 'config.convertDisable=false' and 'config.convertManifestOverride=true'
[Pipeline] echo
Disabling integration test as config.enableIntegrationTest is not true. To enable, set this flag to true.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/e2e-usw2-eks
[Pipeline] {
[Pipeline] fileExists
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] sh
+ rm -f IntegrationTest.yaml
[Pipeline] sh
+ rm kustomization.yaml
[Pipeline] writeYaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] fileExists
[Pipeline] sh
+ cat app-base/kustomization.yaml
+ grep '\- https://github.intuit.com/dev-patterns/intuit-kustomize'
+ awk '-F ' '{print $2;}'
+ grep -E -o 'kustomize\/\/(.*?)\?ref=v([0-9]+\.[0-9]+\.\S+?)'
+ sed 's/kustomize\/\///g'
+ sed 's/\?ref=/:/g'
[Pipeline] readYaml
[Pipeline] sh
+ awk -v envPath=environments/e2e-usw2-eks -v assetId=2597468678172884775 -v assetAlias=Intuit.learning.learnexp.i4eappservice -v serviceName=i4eappservice -F: '{print "Intuit-kustomize, environment:"envPath", assetId:"assetId", assetAlias:"assetAlias", serviceName:"serviceName", base:"$1", version:"$2"";}'
+ echo 'intuit-metrics-service-base:v6.0.0
intuit-service-rollout-hpa-base:v6.0.0
intuit-service-rollout-canary-base:v6.0.0
intuit-service-rollout-ingress-base:v6.0.0
'
Intuit-kustomize, environment:environments/e2e-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-metrics-service-base, version:v6.0.0
Intuit-kustomize, environment:environments/e2e-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-hpa-base, version:v6.0.0
Intuit-kustomize, environment:environments/e2e-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-canary-base, version:v6.0.0
Intuit-kustomize, environment:environments/e2e-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-ingress-base, version:v6.0.0
Intuit-kustomize, environment:environments/e2e-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:, version:
[Pipeline] echo
Trying to use vanilla kustomize: /usr/local/bin/kustomize-v4.5.5
[Pipeline] sh
+ /usr/local/bin/kustomize-v4.5.5 build environments/e2e-usw2-eks
2024/04/16 01:16:05 well-defined vars that were never replaced: SELECTOR,IMAGE_URL
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-e2e
    eks.amazonaws.com/sts-regional-endpoints: "true"
  name: workflow-service-account
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: workflow-role
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - watch
  - patch
- apiGroups:
  - ""
  resources:
  - pods/log
  verbs:
  - get
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: workflow-role-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: workflow-role
subjects:
- kind: ServiceAccount
  name: workflow-service-account
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-desired-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-root-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    iks-metric: actuator-prometheus
    mesh-metrics: mesh-envoy-prometheus
  name: i4eappservice-service-metrics
spec:
  ports:
  - name: iks-metric
    port: 8490
    targetPort: 8490
  selector:
    app: i4eappservice
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-stable-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: i4eappservice-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: i4eappservice
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-cpu-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: cpu-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: cpu-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_cpu_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.cpu-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-error-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: error-rate-limit-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: error-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_errors_5xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
          OR on() vector(0)
    successCondition: result[0] <= {{args.error-rate-limit-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-memory-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: memory-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: memory-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_memory_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.memory-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-pod-restarts
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: pod-restarts
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          sum(
          sum_over_time(kube_pod_container_status_restarts_total{namespace="{{args.namespace}}",pod=~".*-{{args.canary-hash}}-.*"}[5m])
          )
    successCondition: result[0] == 0
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-request-latency
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: request-latency-limit-msec
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: request-latency
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.95, quantile_over_time(0.95, namespace_pod_http_server_requests_latency{namespace="{{args.namespace}}",
          rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))*1000)
    successCondition: 'len(result) > 0? result[0] < {{args.request-latency-limit-msec}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
    successCondition: 'len(result) > 0? result[0] >= {{args.success-rate-min-percentage}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate-include4xx
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-include4xx-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate-excld4xx
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: "(sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace=\"{{args.namespace}}\",
          rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])) + sum(sum_over_time(namespace_pod_http_server_requests_errors_4xx{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])))
          \n/ \nsum(sum_over_time(namespace_pod_http_server_requests_count{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m]))
          * 100"
    successCondition: result[0] >= {{args.success-rate-include4xx-min-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  labels:
    app: i4eappservice
    appType: spring-boot
    assetAlias: Intuit.learning.learnexp.i4eappservice
    assetId: "2597468678172884775"
    buildType: maven
    env: e2e-usw2-eks
    l1: learning
    l2: learnexp
  name: i4eappservice-rollout
spec:
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: i4eappservice
  strategy:
    canary:
      analysis:
        args:
        - name: stable-hash
          valueFrom:
            podTemplateHashValue: Stable
        - name: canary-hash
          valueFrom:
            podTemplateHashValue: Latest
        - name: prometheus-port
          value: "9090"
        - name: namespace
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: success-rate-min-percentage
          value: "96"
        - name: error-rate-limit-percentage
          value: "4"
        - name: cpu-utilization-limit-perc
          value: "80"
        - name: memory-utilization-limit-perc
          value: "80"
        - name: request-latency-limit-msec
          value: "400"
        - name: count
          value: "0"
        - name: initial-delay
          value: 1m
        - name: interval
          value: 60s
        - name: failure-limit
          value: "1"
        - name: inconclusive-limit
          value: "1"
        startingStep: 1
        templates:
        - templateName: i4eappservice-cpu-utilization
        - templateName: i4eappservice-memory-utilization
      canaryMetadata:
        annotations:
          role: canary
        labels:
          role: canary
      canaryService: i4eappservice-desired-service
      maxSurge: 25%
      maxUnavailable: 0%
      stableMetadata:
        annotations:
          role: stable
        labels:
          role: stable
      stableService: i4eappservice-stable-service
      steps:
      - setWeight: 25
      - pause:
          duration: 5m
      - setWeight: 50
      - pause:
          duration: 5m
  template:
    metadata:
      annotations:
        admiral.io/env: e2e
        alpha.istio.io/identity: Intuit.learning.learnexp.i4eappservice
        iam.amazonaws.com/role: disabled
        policyId: p-xcbszzk1dwpx
        sidecar.istio.io/inject: "true"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: 169.254.169.254/32
        traffic.sidecar.istio.io/excludeOutboundPorts: 3306,3308,61617,443
        traffic.sidecar.istio.io/includeInboundPorts: "8090"
      labels:
        app: i4eappservice
        assetAlias: Intuit.learning.learnexp.i4eappservice
        assetId: "2597468678172884775"
        env: e2e-usw2-eks
        istio-injected: "true"
        l1: learning
        l2: learnexp
    spec:
      containers:
      - env:
        - name: MESH_ENABLED
          value: "true"
        - name: MESH_SIDECAR_PORT
          value: "15000"
        - name: MESH_TRAFFIC_PORT
          value: "8090"
        - name: APP_ENV
          value: e2e
        - name: APP_DATABASE_HOST
          value: e2edbcluster-0i3mehq9lzla.cluster-cqrg5qvpneyz.us-west-2.docdb.amazonaws.com
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        - name: L1
          value: learning
        - name: L2
          value: learnexp
        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
        name: app
        ports:
        - containerPort: 8443
          name: service
        - containerPort: 8490
          name: metrics
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health/full
            port: 8443
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 5
          successThreshold: 2
          timeoutSeconds: 2
        resources:
          limits:
            cpu: 700m
            memory: 3Gi
          requests:
            cpu: 700m
            memory: 3Gi
      initContainers:
      - env:
        - name: APP_ENV
          value: e2e
        - name: SEGMENT_CLUSTER_ROLE_ARN
          value: arn:aws:iam::000767522314:role/shared.futures-ppd-usw2-k8s
        - name: SEGMENT_IDPS_APPLIANCE
          value: MSaaSBU01-PRODUCTION-PSIQSZ.pd.idps.a.intuit.com
        - name: SEGMENT_IDPS_POLICY_ID
          value: p-id871oygoxoe
        - name: AWS_SDK_LOAD_CONFIG
          value: "1"
        - name: AWS_ROLE_SESSION_NAME
          value: kiam-kiam
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        image: docker.intuit.com/dev/containers/segment-app-init/service/segment-app-init:1.1
        name: segment-app-init
---
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-hpa
spec:
  behavior:
    scaleDown:
      policies:
      - periodSeconds: 60
        type: Percent
        value: 10
      selectPolicy: Min
      stabilizationWindowSeconds: 300
    scaleUp:
      policies:
      - periodSeconds: 15
        type: Percent
        value: 40
      - periodSeconds: 15
        type: Pods
        value: 2
      selectPolicy: Max
      stabilizationWindowSeconds: 0
  maxReplicas: 20
  metrics:
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_pod_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_container_app_ready_only_avg_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  minReplicas: 2
  scaleTargetRef:
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    name: i4eappservice-rollout
---
apiVersion: iammanager.keikoproj.io/v1alpha1
kind: Iamrole
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
    iam.amazonaws.com/irsa-service-account: default,workflow-service-account
  name: iamrole
spec:
  PolicyDocument:
    Statement:
    - Action:
      - ec2:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - iam:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - sts:AssumeRole
      Effect: Allow
      Resource:
      - arn:aws:iam::013156140003:role/pipeline-s3-role-ppd-us-west-2
      - arn:aws:iam::164507085864:role/e2e-i4e-app-access-aws-role
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol: HTTPS
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:000767522314:certificate/7f801c70-ced0-4832-9c47-937d0d656dc6
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-path: /health/full
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=false
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/security-groups: iks-intuit-cidr-ingress-tcp-443,iks-intuit-api-gw-ingress-preprod-tcp-443,iks-intuit-app-alb-custom-ingress,iks-intuit-ibp-ingress-tcp-443
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/target-type: ip
    argocd.argoproj.io/sync-wave: "-1"
    external-dns.alpha.kubernetes.io/hostname: learning-e2e-i4eappservice.futuresppdusw2.iks2.a.intuit.com,
      learning-e2e-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com, learning-e2e-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-ingress
spec:
  ingressClassName: aws-alb
  rules:
  - host: learning-e2e-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-desired-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-e2e-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-stable-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - http:
      paths:
      - backend:
          service:
            name: i4eappservice-root-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
[Pipeline] echo
Using default kustomize: kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] echo
run kustomize with environments
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:16:06.126237130
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ cd environments/e2e-usw2-eks
+ /usr/local/bin/kustomize-v4.5.5 build
2024/04/16 01:16:11 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] pwd
[Pipeline] echo
renderManifest writing runKustomizeBuild output at /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml
[Pipeline] writeFile
[Pipeline] echo
Using default kustomize (cached): kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] sh
+ iconvert --version
iconvert version {"version": "v1.2.1", "gitCommit": "a029614", "buildDate": "2023-08-23T23:19:06Z"}
[Pipeline] sh
+ iconvert --kustomize /usr/local/bin/kustomize-v4.5.5 --input-file /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml --config /.convert-config.yaml --debug
time="2024-04-16T01:16:31Z" level=debug msg="using tmp directory '/tmp/iconvert158176356'"
time="2024-04-16T01:16:31Z" level=debug msg="splitting '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml' into individual files in '/tmp/iconvert158176356'... "
time="2024-04-16T01:16:31Z" level=info msg="Using ConfigFile @ /.convert-config.yaml"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'Ingress' with ApiVersion 'networking.k8s.io/v1'..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Ingress' with ApiVersion 'networking.k8s.io/v1' on 'Ingress-i4eappservice-rollout-ingress.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version networking.k8s.io/v1 -f /tmp/iconvert158176356/Ingress-i4eappservice-rollout-ingress-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"loadBalancer": Map{}},

time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by provided Processor for kind: 'Ingress'"

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/Ingress-i4eappservice-rollout-ingress-copy.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'Role-workflow-role.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert158176356/Role-workflow-role-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/Role-workflow-role-copy.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'RoleBinding-workflow-role-binding.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert158176356/RoleBinding-workflow-role-binding-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/RoleBinding-workflow-role-binding-copy.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1' on 'RoleBinding-workflow-role-binding.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version rbac.authorization.k8s.io/v1 -f /tmp/iconvert158176356/RoleBinding-workflow-role-binding-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,

time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by provided Processor for kind: 'RoleBinding'"

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/RoleBinding-workflow-role-binding-copy.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'PodDisruptionBudget' with ApiVersion 'policy/v1'..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'PodDisruptionBudget' with ApiVersion 'policy/v1' on 'PodDisruptionBudget-i4eappservice-pdb.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version policy/v1 -f /tmp/iconvert158176356/PodDisruptionBudget-i4eappservice-pdb-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{
- 		"currentHealthy":     Number(0),
- 		"desiredHealthy":     Number(0),
- 		"disruptionsAllowed": Number(0),
- 		"expectedPods":       Number(0),
- 	},

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/PodDisruptionBudget-i4eappservice-pdb-copy.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2'..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2' on 'HorizontalPodAutoscaler-i4eappservice-rollout-hpa.yaml'"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version autoscaling/v2 -f /tmp/iconvert158176356/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml"
time="2024-04-16T01:16:31Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"currentMetrics": nil, "desiredReplicas": Number(0)},

time="2024-04-16T01:16:31Z" level=debug msg="removing tmp file '/tmp/iconvert158176356/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="updating Kind 'CronJob' with ApiVersion 'batch/v1'..."
time="2024-04-16T01:16:31Z" level=info msg="Resource 'CronJob' not found skipping ..."
time="2024-04-16T01:16:31Z" level=debug msg="running '/usr/local/bin/kustomize-v4.5.5' in '/tmp/iconvert158176356' to unify files"
time="2024-04-16T01:16:31Z" level=debug msg="/usr/local/bin/kustomize-v4.5.5 build /tmp/iconvert158176356"
time="2024-04-16T01:16:31Z" level=debug msg="creating temporary rendered file at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
time="2024-04-16T01:16:31Z" level=info msg="showing differences:"

apiVersion  (PodDisruptionBudget/default/i4eappservice-pdb)
  ± value change
    - policy/v1beta1
    + policy/v1

apiVersion  (HorizontalPodAutoscaler/default/i4eappservice-rollout-hpa)
  ± value change
    - autoscaling/v2beta2
    + autoscaling/v2

time="2024-04-16T01:16:31Z" level=debug msg="removing temporary rendered file generated at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] echo
renderManifest returning iconvert output
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/e2e-usw2-eks
[Pipeline] {
[Pipeline] echo
Integration test disabled. Resetting files.
[Pipeline] echo
Resetting integration test file IntegrationTest.yaml
[Pipeline] sh
+ git restore IntegrationTest.yaml
[Pipeline] echo
Resetting integration test file kustomization.yaml
[Pipeline] sh
+ git restore kustomization.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] echo
render manifest with environments
[Pipeline] echo
renderManifest 'config.convertDisable=false' and 'config.convertManifestOverride=true'
[Pipeline] echo
Disabling integration test as config.enableIntegrationTest is not true. To enable, set this flag to true.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/stg-usw2-eks
[Pipeline] {
[Pipeline] fileExists
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] sh
+ rm -f IntegrationTest.yaml
[Pipeline] sh
+ rm kustomization.yaml
[Pipeline] writeYaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] fileExists
[Pipeline] sh
+ cat app-base/kustomization.yaml
+ awk '-F ' '{print $2;}'
+ grep -E -o 'kustomize\/\/(.*?)\?ref=v([0-9]+\.[0-9]+\.\S+?)'
+ sed 's/kustomize\/\///g'
+ sed 's/\?ref=/:/g'
+ grep '\- https://github.intuit.com/dev-patterns/intuit-kustomize'
[Pipeline] readYaml
[Pipeline] sh
+ echo 'intuit-metrics-service-base:v6.0.0
intuit-service-rollout-hpa-base:v6.0.0
intuit-service-rollout-canary-base:v6.0.0
intuit-service-rollout-ingress-base:v6.0.0
'
+ awk -v envPath=environments/stg-usw2-eks -v assetId=2597468678172884775 -v assetAlias=Intuit.learning.learnexp.i4eappservice -v serviceName=i4eappservice -F: '{print "Intuit-kustomize, environment:"envPath", assetId:"assetId", assetAlias:"assetAlias", serviceName:"serviceName", base:"$1", version:"$2"";}'
Intuit-kustomize, environment:environments/stg-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-metrics-service-base, version:v6.0.0
Intuit-kustomize, environment:environments/stg-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-hpa-base, version:v6.0.0
Intuit-kustomize, environment:environments/stg-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-canary-base, version:v6.0.0
Intuit-kustomize, environment:environments/stg-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-ingress-base, version:v6.0.0
Intuit-kustomize, environment:environments/stg-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:, version:
[Pipeline] echo
Trying to use vanilla kustomize: /usr/local/bin/kustomize-v4.5.5
[Pipeline] sh
+ /usr/local/bin/kustomize-v4.5.5 build environments/stg-usw2-eks
2024/04/16 01:16:40 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-desired-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-root-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    iks-metric: actuator-prometheus
    mesh-metrics: mesh-envoy-prometheus
  name: i4eappservice-service-metrics
spec:
  ports:
  - name: iks-metric
    port: 8490
    targetPort: 8490
  selector:
    app: i4eappservice
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-stable-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: i4eappservice-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: i4eappservice
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-cpu-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: cpu-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: cpu-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_cpu_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.cpu-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-error-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: error-rate-limit-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: error-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_errors_5xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
          OR on() vector(0)
    successCondition: result[0] <= {{args.error-rate-limit-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-memory-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: memory-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: memory-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_memory_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.memory-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-pod-restarts
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: pod-restarts
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          sum(
          sum_over_time(kube_pod_container_status_restarts_total{namespace="{{args.namespace}}",pod=~".*-{{args.canary-hash}}-.*"}[5m])
          )
    successCondition: result[0] == 0
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-request-latency
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: request-latency-limit-msec
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: request-latency
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.95, quantile_over_time(0.95, namespace_pod_http_server_requests_latency{namespace="{{args.namespace}}",
          rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))*1000)
    successCondition: 'len(result) > 0? result[0] < {{args.request-latency-limit-msec}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
    successCondition: 'len(result) > 0? result[0] >= {{args.success-rate-min-percentage}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate-include4xx
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-include4xx-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate-excld4xx
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: "(sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace=\"{{args.namespace}}\",
          rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])) + sum(sum_over_time(namespace_pod_http_server_requests_errors_4xx{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])))
          \n/ \nsum(sum_over_time(namespace_pod_http_server_requests_count{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m]))
          * 100"
    successCondition: result[0] >= {{args.success-rate-include4xx-min-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  labels:
    app: i4eappservice
    appType: spring-boot
    assetAlias: Intuit.learning.learnexp.i4eappservice
    assetId: "2597468678172884775"
    buildType: maven
    env: stg-usw2-eks
    l1: learning
    l2: learnexp
  name: i4eappservice-rollout
spec:
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: i4eappservice
  strategy:
    canary:
      analysis:
        args:
        - name: stable-hash
          valueFrom:
            podTemplateHashValue: Stable
        - name: canary-hash
          valueFrom:
            podTemplateHashValue: Latest
        - name: prometheus-port
          value: "9090"
        - name: namespace
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: success-rate-min-percentage
          value: "96"
        - name: error-rate-limit-percentage
          value: "4"
        - name: cpu-utilization-limit-perc
          value: "80"
        - name: memory-utilization-limit-perc
          value: "80"
        - name: request-latency-limit-msec
          value: "400"
        - name: count
          value: "0"
        - name: initial-delay
          value: 1m
        - name: interval
          value: 60s
        - name: failure-limit
          value: "1"
        - name: inconclusive-limit
          value: "1"
        startingStep: 1
        templates:
        - templateName: i4eappservice-cpu-utilization
        - templateName: i4eappservice-memory-utilization
      canaryMetadata:
        annotations:
          role: canary
        labels:
          role: canary
      canaryService: i4eappservice-desired-service
      maxSurge: 25%
      maxUnavailable: 0%
      stableMetadata:
        annotations:
          role: stable
        labels:
          role: stable
      stableService: i4eappservice-stable-service
      steps:
      - setWeight: 10
      - pause:
          duration: 5m
      - setWeight: 30
      - pause:
          duration: 5m
      - setWeight: 50
      - pause:
          duration: 5m
      - setWeight: 80
      - pause:
          duration: 5m
  template:
    metadata:
      annotations:
        admiral.io/env: stg
        alpha.istio.io/identity: Intuit.learning.learnexp.i4eappservice
        iam.amazonaws.com/role: disabled
        policyId: p-w3tf1lkrj9ki
        sidecar.istio.io/inject: "true"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: 169.254.169.254/32
        traffic.sidecar.istio.io/excludeOutboundPorts: 3306,3308,61617,443
        traffic.sidecar.istio.io/includeInboundPorts: "8090"
      labels:
        app: i4eappservice
        assetAlias: Intuit.learning.learnexp.i4eappservice
        assetId: "2597468678172884775"
        env: stg-usw2-eks
        istio-injected: "true"
        l1: learning
        l2: learnexp
    spec:
      containers:
      - env:
        - name: MESH_ENABLED
          value: "true"
        - name: MESH_SIDECAR_PORT
          value: "15000"
        - name: MESH_TRAFFIC_PORT
          value: "8090"
        - name: APP_ENV
          value: stg
        - name: APP_DATABASE_HOST
          value: stgdbcluster-78h4xdjkus44.cluster-cf7zozr2utvv.us-west-2.docdb.amazonaws.com
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        - name: L1
          value: learning
        - name: L2
          value: learnexp
        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
        name: app
        ports:
        - containerPort: 8443
          name: service
        - containerPort: 8490
          name: metrics
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health/full
            port: 8443
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 5
          successThreshold: 2
          timeoutSeconds: 2
        resources:
          limits:
            cpu: 700m
            memory: 3Gi
          requests:
            cpu: 700m
            memory: 3Gi
      initContainers:
      - env:
        - name: APP_ENV
          value: stg
        - name: SEGMENT_CLUSTER_ROLE_ARN
          value: arn:aws:iam::286730789509:role/shared.futures-prd-usw2-k8s
        - name: SEGMENT_IDPS_APPLIANCE
          value: MSaaSBU01-PRODUCTION-PSIQSZ.pd.idps.a.intuit.com
        - name: SEGMENT_IDPS_POLICY_ID
          value: p-otyb8idr4c5t
        - name: AWS_SDK_LOAD_CONFIG
          value: "1"
        - name: AWS_ROLE_SESSION_NAME
          value: kiam-kiam
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        image: docker.intuit.com/dev/containers/segment-app-init/service/segment-app-init:1.1
        name: segment-app-init
---
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-hpa
spec:
  behavior:
    scaleDown:
      policies:
      - periodSeconds: 60
        type: Percent
        value: 10
      selectPolicy: Min
      stabilizationWindowSeconds: 300
    scaleUp:
      policies:
      - periodSeconds: 15
        type: Percent
        value: 40
      - periodSeconds: 15
        type: Pods
        value: 2
      selectPolicy: Max
      stabilizationWindowSeconds: 0
  maxReplicas: 10
  metrics:
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_pod_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_container_app_ready_only_avg_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  minReplicas: 1
  scaleTargetRef:
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    name: i4eappservice-rollout
---
apiVersion: iammanager.keikoproj.io/v1alpha1
kind: Iamrole
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
    iam.amazonaws.com/irsa-service-account: default
  name: iamrole
spec:
  PolicyDocument:
    Statement:
    - Action:
      - ec2:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - iam:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - sts:AssumeRole
      Effect: Allow
      Resource:
      - arn:aws:iam::988989024863:role/stg-i4e-app-access-aws-role
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol: HTTPS
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:286730789509:certificate/d19ff593-d471-480f-805b-823df1e74069
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-path: /health/full
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=false
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/security-groups: iks-intuit-cidr-ingress-tcp-443,iks-intuit-api-gw-ingress-prod-tcp-443,iks-intuit-app-alb-custom-ingress,iks-intuit-ibp-ingress-tcp-443
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/target-type: ip
    argocd.argoproj.io/sync-wave: "-1"
    external-dns.alpha.kubernetes.io/hostname: learning-stg-i4eappservice.futuresprdusw2.iks2.a.intuit.com,
      learning-stg-i4eappservice-desired.futuresprdusw2.iks2.a.intuit.com, learning-stg-i4eappservice-stable.futuresprdusw2.iks2.a.intuit.com
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-ingress
spec:
  ingressClassName: aws-alb
  rules:
  - host: learning-stg-i4eappservice-desired.futuresprdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-desired-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-stg-i4eappservice-stable.futuresprdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-stable-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - http:
      paths:
      - backend:
          service:
            name: i4eappservice-root-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
[Pipeline] echo
Using default kustomize: kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] echo
run kustomize with environments
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:16:41.518799763
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ cd environments/stg-usw2-eks
+ /usr/local/bin/kustomize-v4.5.5 build
2024/04/16 01:16:46 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] pwd
[Pipeline] echo
renderManifest writing runKustomizeBuild output at /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml
[Pipeline] writeFile
[Pipeline] echo
Using default kustomize (cached): kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] sh
+ iconvert --version
iconvert version {"version": "v1.2.1", "gitCommit": "a029614", "buildDate": "2023-08-23T23:19:06Z"}
[Pipeline] sh
+ iconvert --kustomize /usr/local/bin/kustomize-v4.5.5 --input-file /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml --config /.convert-config.yaml --debug
time="2024-04-16T01:16:48Z" level=debug msg="using tmp directory '/tmp/iconvert946780'"
time="2024-04-16T01:16:48Z" level=debug msg="splitting '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml' into individual files in '/tmp/iconvert946780'... "
time="2024-04-16T01:16:48Z" level=info msg="Using ConfigFile @ /.convert-config.yaml"
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'Ingress' with ApiVersion 'networking.k8s.io/v1'..."
time="2024-04-16T01:16:48Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Ingress' with ApiVersion 'networking.k8s.io/v1' on 'Ingress-i4eappservice-rollout-ingress.yaml'"
time="2024-04-16T01:16:48Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version networking.k8s.io/v1 -f /tmp/iconvert946780/Ingress-i4eappservice-rollout-ingress-copy.yaml"
time="2024-04-16T01:16:48Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"loadBalancer": Map{}},

time="2024-04-16T01:16:48Z" level=debug msg="showing differences generated by provided Processor for kind: 'Ingress'"

time="2024-04-16T01:16:48Z" level=debug msg="removing tmp file '/tmp/iconvert946780/Ingress-i4eappservice-rollout-ingress-copy.yaml'"
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:16:48Z" level=info msg="Resource 'Role' not found skipping ..."
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:16:48Z" level=info msg="Resource 'RoleBinding' not found skipping ..."
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'PodDisruptionBudget' with ApiVersion 'policy/v1'..."
time="2024-04-16T01:16:48Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'PodDisruptionBudget' with ApiVersion 'policy/v1' on 'PodDisruptionBudget-i4eappservice-pdb.yaml'"
time="2024-04-16T01:16:48Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version policy/v1 -f /tmp/iconvert946780/PodDisruptionBudget-i4eappservice-pdb-copy.yaml"
time="2024-04-16T01:16:48Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{
- 		"currentHealthy":     Number(0),
- 		"desiredHealthy":     Number(0),
- 		"disruptionsAllowed": Number(0),
- 		"expectedPods":       Number(0),
- 	},

time="2024-04-16T01:16:48Z" level=debug msg="removing tmp file '/tmp/iconvert946780/PodDisruptionBudget-i4eappservice-pdb-copy.yaml'"
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2'..."
time="2024-04-16T01:16:48Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2' on 'HorizontalPodAutoscaler-i4eappservice-rollout-hpa.yaml'"
time="2024-04-16T01:16:48Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version autoscaling/v2 -f /tmp/iconvert946780/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml"
time="2024-04-16T01:16:48Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"currentMetrics": nil, "desiredReplicas": Number(0)},

time="2024-04-16T01:16:48Z" level=debug msg="removing tmp file '/tmp/iconvert946780/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml'"
time="2024-04-16T01:16:48Z" level=info msg="updating Kind 'CronJob' with ApiVersion 'batch/v1'..."
time="2024-04-16T01:16:48Z" level=info msg="Resource 'CronJob' not found skipping ..."
time="2024-04-16T01:16:48Z" level=debug msg="running '/usr/local/bin/kustomize-v4.5.5' in '/tmp/iconvert946780' to unify files"
time="2024-04-16T01:16:48Z" level=debug msg="/usr/local/bin/kustomize-v4.5.5 build /tmp/iconvert946780"
time="2024-04-16T01:16:48Z" level=debug msg="creating temporary rendered file at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
time="2024-04-16T01:16:48Z" level=info msg="showing differences:"

apiVersion  (PodDisruptionBudget/default/i4eappservice-pdb)
  ± value change
    - policy/v1beta1
    + policy/v1

apiVersion  (HorizontalPodAutoscaler/default/i4eappservice-rollout-hpa)
  ± value change
    - autoscaling/v2beta2
    + autoscaling/v2

time="2024-04-16T01:16:48Z" level=debug msg="removing temporary rendered file generated at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] echo
renderManifest returning iconvert output
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/stg-usw2-eks
[Pipeline] {
[Pipeline] echo
Integration test disabled. Resetting files.
[Pipeline] echo
Resetting integration test file IntegrationTest.yaml
[Pipeline] sh
+ git restore IntegrationTest.yaml
[Pipeline] echo
Resetting integration test file kustomization.yaml
[Pipeline] sh
+ git restore kustomization.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] echo
render manifest with environments
[Pipeline] echo
renderManifest 'config.convertDisable=false' and 'config.convertManifestOverride=true'
[Pipeline] echo
Disabling integration test as config.enableIntegrationTest is not true. To enable, set this flag to true.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prd-usw2-eks
[Pipeline] {
[Pipeline] fileExists
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] sh
+ rm -f IntegrationTest.yaml
[Pipeline] sh
+ rm kustomization.yaml
[Pipeline] writeYaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] fileExists
[Pipeline] sh
+ cat app-base/kustomization.yaml
+ grep '\- https://github.intuit.com/dev-patterns/intuit-kustomize'
+ awk '-F ' '{print $2;}'
+ grep -E -o 'kustomize\/\/(.*?)\?ref=v([0-9]+\.[0-9]+\.\S+?)'
+ sed 's/\?ref=/:/g'
+ sed 's/kustomize\/\///g'
[Pipeline] readYaml
[Pipeline] sh
+ echo 'intuit-metrics-service-base:v6.0.0
intuit-service-rollout-hpa-base:v6.0.0
intuit-service-rollout-canary-base:v6.0.0
intuit-service-rollout-ingress-base:v6.0.0
'
+ awk -v envPath=environments/prd-usw2-eks -v assetId=2597468678172884775 -v assetAlias=Intuit.learning.learnexp.i4eappservice -v serviceName=i4eappservice -F: '{print "Intuit-kustomize, environment:"envPath", assetId:"assetId", assetAlias:"assetAlias", serviceName:"serviceName", base:"$1", version:"$2"";}'
Intuit-kustomize, environment:environments/prd-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-metrics-service-base, version:v6.0.0
Intuit-kustomize, environment:environments/prd-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-hpa-base, version:v6.0.0
Intuit-kustomize, environment:environments/prd-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-canary-base, version:v6.0.0
Intuit-kustomize, environment:environments/prd-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-ingress-base, version:v6.0.0
Intuit-kustomize, environment:environments/prd-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:, version:
[Pipeline] echo
Trying to use vanilla kustomize: /usr/local/bin/kustomize-v4.5.5
[Pipeline] sh
+ /usr/local/bin/kustomize-v4.5.5 build environments/prd-usw2-eks
2024/04/16 01:16:58 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-desired-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-root-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    iks-metric: actuator-prometheus
    mesh-metrics: mesh-envoy-prometheus
  name: i4eappservice-service-metrics
spec:
  ports:
  - name: iks-metric
    port: 8490
    targetPort: 8490
  selector:
    app: i4eappservice
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-stable-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: i4eappservice-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: i4eappservice
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-cpu-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: cpu-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: cpu-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_cpu_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.cpu-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-error-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: error-rate-limit-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: error-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_errors_5xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
          OR on() vector(0)
    successCondition: result[0] <= {{args.error-rate-limit-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-memory-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: memory-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: memory-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_memory_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.memory-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-pod-restarts
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: pod-restarts
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          sum(
          sum_over_time(kube_pod_container_status_restarts_total{namespace="{{args.namespace}}",pod=~".*-{{args.canary-hash}}-.*"}[5m])
          )
    successCondition: result[0] == 0
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-request-latency
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: request-latency-limit-msec
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: request-latency
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.95, quantile_over_time(0.95, namespace_pod_http_server_requests_latency{namespace="{{args.namespace}}",
          rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))*1000)
    successCondition: 'len(result) > 0? result[0] < {{args.request-latency-limit-msec}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
    successCondition: 'len(result) > 0? result[0] >= {{args.success-rate-min-percentage}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate-include4xx
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-include4xx-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate-excld4xx
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: "(sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace=\"{{args.namespace}}\",
          rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])) + sum(sum_over_time(namespace_pod_http_server_requests_errors_4xx{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])))
          \n/ \nsum(sum_over_time(namespace_pod_http_server_requests_count{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m]))
          * 100"
    successCondition: result[0] >= {{args.success-rate-include4xx-min-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  labels:
    app: i4eappservice
    appType: spring-boot
    assetAlias: Intuit.learning.learnexp.i4eappservice
    assetId: "2597468678172884775"
    buildType: maven
    env: prd-usw2-eks
    l1: learning
    l2: learnexp
  name: i4eappservice-rollout
spec:
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: i4eappservice
  strategy:
    canary:
      analysis:
        args:
        - name: stable-hash
          valueFrom:
            podTemplateHashValue: Stable
        - name: canary-hash
          valueFrom:
            podTemplateHashValue: Latest
        - name: prometheus-port
          value: "9090"
        - name: namespace
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: success-rate-min-percentage
          value: "96"
        - name: error-rate-limit-percentage
          value: "4"
        - name: cpu-utilization-limit-perc
          value: "80"
        - name: memory-utilization-limit-perc
          value: "80"
        - name: request-latency-limit-msec
          value: "400"
        - name: count
          value: "0"
        - name: initial-delay
          value: 1m
        - name: interval
          value: 60s
        - name: failure-limit
          value: "1"
        - name: inconclusive-limit
          value: "1"
        startingStep: 1
        templates:
        - templateName: i4eappservice-cpu-utilization
        - templateName: i4eappservice-memory-utilization
      canaryMetadata:
        annotations:
          role: canary
        labels:
          role: canary
      canaryService: i4eappservice-desired-service
      maxSurge: 25%
      maxUnavailable: 0%
      stableMetadata:
        annotations:
          role: stable
        labels:
          role: stable
      stableService: i4eappservice-stable-service
      steps:
      - setWeight: 10
      - pause:
          duration: 5m
      - setWeight: 30
      - pause:
          duration: 5m
      - setWeight: 50
      - pause:
          duration: 5m
      - setWeight: 80
      - pause:
          duration: 5m
  template:
    metadata:
      annotations:
        admiral.io/env: prd
        alpha.istio.io/identity: Intuit.learning.learnexp.i4eappservice
        iam.amazonaws.com/role: disabled
        policyId: p-w4wzkjxsv9u4
        sidecar.istio.io/inject: "true"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: 169.254.169.254/32
        traffic.sidecar.istio.io/excludeOutboundPorts: 3306,3308,61617,443
        traffic.sidecar.istio.io/includeInboundPorts: "8090"
      labels:
        app: i4eappservice
        assetAlias: Intuit.learning.learnexp.i4eappservice
        assetId: "2597468678172884775"
        env: prd-usw2-eks
        istio-injected: "true"
        l1: learning
        l2: learnexp
    spec:
      containers:
      - env:
        - name: MESH_ENABLED
          value: "true"
        - name: MESH_SIDECAR_PORT
          value: "15000"
        - name: MESH_TRAFFIC_PORT
          value: "8090"
        - name: APP_ENV
          value: prd
        - name: APP_DATABASE_HOST
          value: prddbcluster-ej2cwlfwclrk.cluster-cf7zozr2utvv.us-west-2.docdb.amazonaws.com
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        - name: L1
          value: learning
        - name: L2
          value: learnexp
        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
        name: app
        ports:
        - containerPort: 8443
          name: service
        - containerPort: 8490
          name: metrics
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health/full
            port: 8443
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 5
          successThreshold: 2
          timeoutSeconds: 2
        resources:
          limits:
            cpu: 700m
            memory: 3Gi
          requests:
            cpu: 700m
            memory: 3Gi
      initContainers:
      - env:
        - name: APP_ENV
          value: prd
        - name: SEGMENT_CLUSTER_ROLE_ARN
          value: arn:aws:iam::286730789509:role/shared.futures-prd-usw2-k8s
        - name: SEGMENT_IDPS_APPLIANCE
          value: MSaaSBU01-PRODUCTION-PSIQSZ.pd.idps.a.intuit.com
        - name: SEGMENT_IDPS_POLICY_ID
          value: p-otyb8idr4c5t
        - name: AWS_SDK_LOAD_CONFIG
          value: "1"
        - name: AWS_ROLE_SESSION_NAME
          value: kiam-kiam
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        image: docker.intuit.com/dev/containers/segment-app-init/service/segment-app-init:1.1
        name: segment-app-init
---
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-hpa
spec:
  behavior:
    scaleDown:
      policies:
      - periodSeconds: 60
        type: Percent
        value: 10
      selectPolicy: Min
      stabilizationWindowSeconds: 300
    scaleUp:
      policies:
      - periodSeconds: 15
        type: Percent
        value: 40
      - periodSeconds: 15
        type: Pods
        value: 2
      selectPolicy: Max
      stabilizationWindowSeconds: 0
  maxReplicas: 50
  metrics:
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_pod_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_container_app_ready_only_avg_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  minReplicas: 10
  scaleTargetRef:
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    name: i4eappservice-rollout
---
apiVersion: iammanager.keikoproj.io/v1alpha1
kind: Iamrole
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
    iam.amazonaws.com/irsa-service-account: default
  name: iamrole
spec:
  PolicyDocument:
    Statement:
    - Action:
      - ec2:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - iam:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - sts:AssumeRole
      Effect: Allow
      Resource:
      - arn:aws:iam::988989024863:role/prd-i4e-app-access-aws-role
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol: HTTPS
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:286730789509:certificate/d19ff593-d471-480f-805b-823df1e74069
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-path: /health/full
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=false
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/security-groups: iks-intuit-cidr-ingress-tcp-443,iks-intuit-api-gw-ingress-prod-tcp-443,iks-intuit-app-alb-custom-ingress,iks-intuit-ibp-ingress-tcp-443
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/target-type: ip
    argocd.argoproj.io/sync-wave: "-1"
    external-dns.alpha.kubernetes.io/hostname: learning-prd-i4eappservice.futuresprdusw2.iks2.a.intuit.com,
      learning-prd-i4eappservice-desired.futuresprdusw2.iks2.a.intuit.com, learning-prd-i4eappservice-stable.futuresprdusw2.iks2.a.intuit.com
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-ingress
spec:
  ingressClassName: aws-alb
  rules:
  - host: learning-prd-i4eappservice-desired.futuresprdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-desired-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-prd-i4eappservice-stable.futuresprdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-stable-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - http:
      paths:
      - backend:
          service:
            name: i4eappservice-root-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
[Pipeline] echo
Using default kustomize: kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] echo
run kustomize with environments
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:16:59.232416323
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ cd environments/prd-usw2-eks
+ /usr/local/bin/kustomize-v4.5.5 build
2024/04/16 01:17:05 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] pwd
[Pipeline] echo
renderManifest writing runKustomizeBuild output at /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml
[Pipeline] writeFile
[Pipeline] echo
Using default kustomize (cached): kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] sh
+ iconvert --version
iconvert version {"version": "v1.2.1", "gitCommit": "a029614", "buildDate": "2023-08-23T23:19:06Z"}
[Pipeline] sh
+ iconvert --kustomize /usr/local/bin/kustomize-v4.5.5 --input-file /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml --config /.convert-config.yaml --debug
time="2024-04-16T01:17:11Z" level=debug msg="using tmp directory '/tmp/iconvert714196669'"
time="2024-04-16T01:17:11Z" level=debug msg="splitting '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml' into individual files in '/tmp/iconvert714196669'... "
time="2024-04-16T01:17:11Z" level=info msg="Using ConfigFile @ /.convert-config.yaml"
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'Ingress' with ApiVersion 'networking.k8s.io/v1'..."
time="2024-04-16T01:17:11Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Ingress' with ApiVersion 'networking.k8s.io/v1' on 'Ingress-i4eappservice-rollout-ingress.yaml'"
time="2024-04-16T01:17:11Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version networking.k8s.io/v1 -f /tmp/iconvert714196669/Ingress-i4eappservice-rollout-ingress-copy.yaml"
time="2024-04-16T01:17:11Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"loadBalancer": Map{}},

time="2024-04-16T01:17:11Z" level=debug msg="showing differences generated by provided Processor for kind: 'Ingress'"

time="2024-04-16T01:17:11Z" level=debug msg="removing tmp file '/tmp/iconvert714196669/Ingress-i4eappservice-rollout-ingress-copy.yaml'"
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:17:11Z" level=info msg="Resource 'Role' not found skipping ..."
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:17:11Z" level=info msg="Resource 'RoleBinding' not found skipping ..."
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'PodDisruptionBudget' with ApiVersion 'policy/v1'..."
time="2024-04-16T01:17:11Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'PodDisruptionBudget' with ApiVersion 'policy/v1' on 'PodDisruptionBudget-i4eappservice-pdb.yaml'"
time="2024-04-16T01:17:11Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version policy/v1 -f /tmp/iconvert714196669/PodDisruptionBudget-i4eappservice-pdb-copy.yaml"
time="2024-04-16T01:17:11Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{
- 		"currentHealthy":     Number(0),
- 		"desiredHealthy":     Number(0),
- 		"disruptionsAllowed": Number(0),
- 		"expectedPods":       Number(0),
- 	},

time="2024-04-16T01:17:11Z" level=debug msg="removing tmp file '/tmp/iconvert714196669/PodDisruptionBudget-i4eappservice-pdb-copy.yaml'"
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2'..."
time="2024-04-16T01:17:11Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2' on 'HorizontalPodAutoscaler-i4eappservice-rollout-hpa.yaml'"
time="2024-04-16T01:17:11Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version autoscaling/v2 -f /tmp/iconvert714196669/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml"
time="2024-04-16T01:17:11Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": map[String]interface{}{"currentMetrics": nil, "desiredReplicas": Number(0)},

time="2024-04-16T01:17:11Z" level=debug msg="removing tmp file '/tmp/iconvert714196669/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml'"
time="2024-04-16T01:17:11Z" level=info msg="updating Kind 'CronJob' with ApiVersion 'batch/v1'..."
time="2024-04-16T01:17:11Z" level=info msg="Resource 'CronJob' not found skipping ..."
time="2024-04-16T01:17:11Z" level=debug msg="running '/usr/local/bin/kustomize-v4.5.5' in '/tmp/iconvert714196669' to unify files"
time="2024-04-16T01:17:11Z" level=debug msg="/usr/local/bin/kustomize-v4.5.5 build /tmp/iconvert714196669"
time="2024-04-16T01:17:11Z" level=debug msg="creating temporary rendered file at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
time="2024-04-16T01:17:11Z" level=info msg="showing differences:"

apiVersion  (PodDisruptionBudget/default/i4eappservice-pdb)
  ± value change
    - policy/v1beta1
    + policy/v1

apiVersion  (HorizontalPodAutoscaler/default/i4eappservice-rollout-hpa)
  ± value change
    - autoscaling/v2beta2
    + autoscaling/v2

time="2024-04-16T01:17:11Z" level=debug msg="removing temporary rendered file generated at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] echo
renderManifest returning iconvert output
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prd-usw2-eks
[Pipeline] {
[Pipeline] echo
Integration test disabled. Resetting files.
[Pipeline] echo
Resetting integration test file IntegrationTest.yaml
[Pipeline] sh
+ git restore IntegrationTest.yaml
[Pipeline] echo
Resetting integration test file kustomization.yaml
[Pipeline] sh
+ git restore kustomization.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] echo
render manifest with environments
[Pipeline] echo
renderManifest 'config.convertDisable=false' and 'config.convertManifestOverride=true'
[Pipeline] echo
Disabling integration test as config.enableIntegrationTest is not true. To enable, set this flag to true.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prf-usw2-eks
[Pipeline] {
[Pipeline] fileExists
[Pipeline] readYaml
[Pipeline] fileExists
[Pipeline] sh
+ rm -f IntegrationTest.yaml
[Pipeline] sh
+ rm kustomization.yaml
[Pipeline] writeYaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] fileExists
[Pipeline] sh
+ cat app-base/kustomization.yaml
+ grep '\- https://github.intuit.com/dev-patterns/intuit-kustomize'
+ awk '-F ' '{print $2;}'
+ grep -E -o 'kustomize\/\/(.*?)\?ref=v([0-9]+\.[0-9]+\.\S+?)'
+ sed 's/kustomize\/\///g'
+ sed 's/\?ref=/:/g'
[Pipeline] readYaml
[Pipeline] sh
+ echo 'intuit-metrics-service-base:v6.0.0
intuit-service-rollout-hpa-base:v6.0.0
intuit-service-rollout-canary-base:v6.0.0
intuit-service-rollout-ingress-base:v6.0.0
'
+ awk -v envPath=environments/prf-usw2-eks -v assetId=2597468678172884775 -v assetAlias=Intuit.learning.learnexp.i4eappservice -v serviceName=i4eappservice -F: '{print "Intuit-kustomize, environment:"envPath", assetId:"assetId", assetAlias:"assetAlias", serviceName:"serviceName", base:"$1", version:"$2"";}'
Intuit-kustomize, environment:environments/prf-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-metrics-service-base, version:v6.0.0
Intuit-kustomize, environment:environments/prf-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-hpa-base, version:v6.0.0
Intuit-kustomize, environment:environments/prf-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-canary-base, version:v6.0.0
Intuit-kustomize, environment:environments/prf-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:intuit-service-rollout-ingress-base, version:v6.0.0
Intuit-kustomize, environment:environments/prf-usw2-eks, assetId:2597468678172884775, assetAlias:Intuit.learning.learnexp.i4eappservice, serviceName:i4eappservice, base:, version:
[Pipeline] echo
Trying to use vanilla kustomize: /usr/local/bin/kustomize-v4.5.5
[Pipeline] sh
+ /usr/local/bin/kustomize-v4.5.5 build environments/prf-usw2-eks
2024/04/16 01:17:21 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-desired-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-root-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  labels:
    iks-metric: actuator-prometheus
    mesh-metrics: mesh-envoy-prometheus
  name: i4eappservice-service-metrics
spec:
  ports:
  - name: iks-metric
    port: 8490
    targetPort: 8490
  selector:
    app: i4eappservice
---
apiVersion: v1
kind: Service
metadata:
  name: i4eappservice-stable-service
spec:
  ports:
  - name: http-service-mesh
    port: 8090
    targetPort: 8090
  - name: https
    port: 443
    targetPort: 8443
  selector:
    app: i4eappservice
  type: NodePort
---
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: i4eappservice-pdb
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: i4eappservice
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-cpu-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: cpu-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: cpu-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_cpu_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.cpu-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-error-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: error-rate-limit-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: error-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_errors_5xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
          OR on() vector(0)
    successCondition: result[0] <= {{args.error-rate-limit-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-memory-utilization
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: memory-utilization-limit-perc
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: memory-utilization
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.5, quantile_over_time(0.5, namespace_pod_memory_utilization{namespace="{{args.namespace}}",
          pod=~".*-{{args.canary-hash}}-.*"}[11m])))
    successCondition: result[0] <= {{args.memory-utilization-limit-perc}}
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-pod-restarts
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: pod-restarts
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          sum(
          sum_over_time(kube_pod_container_status_restarts_total{namespace="{{args.namespace}}",pod=~".*-{{args.canary-hash}}-.*"}[5m])
          )
    successCondition: result[0] == 0
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-request-latency
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: request-latency-limit-msec
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: request-latency
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: (quantile(0.95, quantile_over_time(0.95, namespace_pod_http_server_requests_latency{namespace="{{args.namespace}}",
          rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))*1000)
    successCondition: 'len(result) > 0? result[0] < {{args.request-latency-limit-msec}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: |-
          (sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))
          /
          sum(sum_over_time(namespace_pod_http_server_requests_count{namespace="{{args.namespace}}", rollouts_pod_template_hash="{{args.canary-hash}}"}[11m]))) * 100
    successCondition: 'len(result) > 0? result[0] >= {{args.success-rate-min-percentage}}:
      true'
---
apiVersion: argoproj.io/v1alpha1
kind: AnalysisTemplate
metadata:
  name: i4eappservice-success-rate-include4xx
spec:
  args:
  - name: namespace
  - name: stable-hash
  - name: canary-hash
  - name: prometheus-port
  - name: success-rate-include4xx-min-percentage
  - name: initial-delay
    value: 1m
  - name: count
    value: "10"
  - name: interval
    value: 60s
  - name: failure-limit
    value: "1"
  - name: inconclusive-limit
    value: "1"
  metrics:
  - count: '{{args.count}}'
    failureLimit: '{{args.failure-limit}}'
    inconclusiveLimit: '{{args.inconclusive-limit}}'
    initialDelay: '{{args.initial-delay}}'
    interval: '{{args.interval}}'
    name: success-rate-excld4xx
    provider:
      prometheus:
        address: http://prometheus.addon-metricset-ns.svc.cluster.local:{{args.prometheus-port}}
        query: "(sum(sum_over_time(namespace_pod_http_server_requests_2xx{namespace=\"{{args.namespace}}\",
          rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])) + sum(sum_over_time(namespace_pod_http_server_requests_errors_4xx{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m])))
          \n/ \nsum(sum_over_time(namespace_pod_http_server_requests_count{namespace=\"{{args.namespace}}\",rollouts_pod_template_hash=\"{{args.canary-hash}}\"}[11m]))
          * 100"
    successCondition: result[0] >= {{args.success-rate-include4xx-min-percentage}}
---
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  labels:
    app: i4eappservice
    appType: spring-boot
    assetAlias: Intuit.learning.learnexp.i4eappservice
    assetId: "2597468678172884775"
    buildType: maven
    env: prf-usw2-eks
    l1: learning
    l2: learnexp
  name: i4eappservice-rollout
spec:
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: i4eappservice
  strategy:
    canary:
      analysis:
        args:
        - name: stable-hash
          valueFrom:
            podTemplateHashValue: Stable
        - name: canary-hash
          valueFrom:
            podTemplateHashValue: Latest
        - name: prometheus-port
          value: "9090"
        - name: namespace
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: success-rate-min-percentage
          value: "96"
        - name: error-rate-limit-percentage
          value: "4"
        - name: cpu-utilization-limit-perc
          value: "80"
        - name: memory-utilization-limit-perc
          value: "80"
        - name: request-latency-limit-msec
          value: "400"
        - name: count
          value: "0"
        - name: initial-delay
          value: 1m
        - name: interval
          value: 60s
        - name: failure-limit
          value: "1"
        - name: inconclusive-limit
          value: "1"
        startingStep: 1
        templates:
        - templateName: i4eappservice-cpu-utilization
        - templateName: i4eappservice-memory-utilization
      canaryMetadata:
        annotations:
          role: canary
        labels:
          role: canary
      canaryService: i4eappservice-desired-service
      maxSurge: 25%
      maxUnavailable: 0%
      stableMetadata:
        annotations:
          role: stable
        labels:
          role: stable
      stableService: i4eappservice-stable-service
      steps:
      - setWeight: 10
      - pause:
          duration: 5m
      - setWeight: 30
      - pause:
          duration: 5m
      - setWeight: 50
      - pause:
          duration: 5m
      - setWeight: 80
      - pause:
          duration: 5m
  template:
    metadata:
      annotations:
        admiral.io/env: prf
        alpha.istio.io/identity: Intuit.learning.learnexp.i4eappservice
        iam.amazonaws.com/role: disabled
        policyId: p-lnjlj8kmpaot
        sidecar.istio.io/inject: "true"
        traffic.sidecar.istio.io/excludeOutboundIPRanges: 169.254.169.254/32
        traffic.sidecar.istio.io/excludeOutboundPorts: 3306,3308,61617,443
        traffic.sidecar.istio.io/includeInboundPorts: "8090"
      labels:
        app: i4eappservice
        assetAlias: Intuit.learning.learnexp.i4eappservice
        assetId: "2597468678172884775"
        env: prf-usw2-eks
        istio-injected: "true"
        l1: learning
        l2: learnexp
    spec:
      containers:
      - env:
        - name: MESH_ENABLED
          value: "true"
        - name: MESH_SIDECAR_PORT
          value: "15000"
        - name: MESH_TRAFFIC_PORT
          value: "8090"
        - name: APP_ENV
          value: prf
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        - name: L1
          value: learning
        - name: L2
          value: learnexp
        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
        name: app
        ports:
        - containerPort: 8443
          name: service
        - containerPort: 8490
          name: metrics
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /health/full
            port: 8443
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 5
          successThreshold: 2
          timeoutSeconds: 2
        resources:
          limits:
            cpu: 700m
            memory: 3Gi
          requests:
            cpu: 700m
            memory: 3Gi
      initContainers:
      - env:
        - name: APP_ENV
          value: prf
        - name: SEGMENT_CLUSTER_ROLE_ARN
          value: arn:aws:iam::000767522314:role/shared.futures-ppd-usw2-k8s
        - name: SEGMENT_IDPS_APPLIANCE
          value: MSaaSBU01-PRODUCTION-PSIQSZ.pd.idps.a.intuit.com
        - name: SEGMENT_IDPS_POLICY_ID
          value: p-id871oygoxoe
        - name: AWS_SDK_LOAD_CONFIG
          value: "1"
        - name: AWS_ROLE_SESSION_NAME
          value: kiam-kiam
        - name: APP_NAME
          value: i4eappservice
        - name: ASSET_ID
          value: "2597468678172884775"
        - name: ASSET_ALIAS
          value: Intuit.learning.learnexp.i4eappservice
        image: docker.intuit.com/dev/containers/segment-app-init/service/segment-app-init:1.1
        name: segment-app-init
---
apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-hpa
spec:
  behavior:
    scaleDown:
      policies:
      - periodSeconds: 60
        type: Percent
        value: 10
      selectPolicy: Min
      stabilizationWindowSeconds: 300
    scaleUp:
      policies:
      - periodSeconds: 15
        type: Percent
        value: 40
      - periodSeconds: 15
        type: Pods
        value: 2
      selectPolicy: Max
      stabilizationWindowSeconds: 0
  maxReplicas: 10
  metrics:
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_pod_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  - object:
      describedObject:
        apiVersion: apps/v1
        kind: Deployment
        name: i4eappservice
      metric:
        name: namespace_app_container_app_ready_only_avg_cpu_utilization
      target:
        type: Value
        value: 50
    type: Object
  minReplicas: 3
  scaleTargetRef:
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    name: i4eappservice-rollout
---
apiVersion: iammanager.keikoproj.io/v1alpha1
kind: Iamrole
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
    iam.amazonaws.com/irsa-service-account: default
  name: iamrole
spec:
  PolicyDocument:
    Statement:
    - Action:
      - ec2:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - iam:*
      Effect: Deny
      Resource:
      - '*'
    - Action:
      - sts:AssumeRole
      Effect: Allow
      Resource:
      - arn:aws:iam::164507085864:role/prf-i4e-app-access-aws-role
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    alb.ingress.kubernetes.io/backend-protocol: HTTPS
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:000767522314:certificate/7f801c70-ced0-4832-9c47-937d0d656dc6
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
    alb.ingress.kubernetes.io/healthcheck-path: /health/full
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=false
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/security-groups: iks-intuit-cidr-ingress-tcp-443,iks-intuit-api-gw-ingress-preprod-tcp-443,iks-intuit-app-alb-custom-ingress,iks-intuit-ibp-ingress-tcp-443
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/target-type: ip
    argocd.argoproj.io/sync-wave: "-1"
    external-dns.alpha.kubernetes.io/hostname: learning-prf-i4eappservice.futuresppdusw2.iks2.a.intuit.com,
      learning-prf-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com, learning-prf-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com
  labels:
    app: i4eappservice
  name: i4eappservice-rollout-ingress
spec:
  ingressClassName: aws-alb
  rules:
  - host: learning-prf-i4eappservice-desired.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-desired-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - host: learning-prf-i4eappservice-stable.futuresppdusw2.iks2.a.intuit.com
    http:
      paths:
      - backend:
          service:
            name: i4eappservice-stable-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
  - http:
      paths:
      - backend:
          service:
            name: i4eappservice-root-service
            port:
              number: 443
        path: /*
        pathType: ImplementationSpecific
[Pipeline] echo
Using default kustomize: kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] echo
run kustomize with environments
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:17:22.046261519
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] sh
+ cd environments/prf-usw2-eks
+ /usr/local/bin/kustomize-v4.5.5 build
2024/04/16 01:17:26 well-defined vars that were never replaced: IMAGE_URL,SELECTOR
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] pwd
[Pipeline] echo
renderManifest writing runKustomizeBuild output at /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml
[Pipeline] writeFile
[Pipeline] echo
Using default kustomize (cached): kustomize-v4.5.5
[Pipeline] echo
kustomize version for renderManifest: version=kustomize-v4.5.5 path=/usr/local/bin/kustomize-v4.5.5 assetId=2597468678172884775 assetAlias=Intuit.learning.learnexp.i4eappservice serviceName=i4eappservice
[Pipeline] sh
+ iconvert --version
iconvert version {"version": "v1.2.1", "gitCommit": "a029614", "buildDate": "2023-08-23T23:19:06Z"}
[Pipeline] sh
+ iconvert --kustomize /usr/local/bin/kustomize-v4.5.5 --input-file /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml --config /.convert-config.yaml --debug
time="2024-04-16T01:17:28Z" level=debug msg="using tmp directory '/tmp/iconvert3561298153'"
time="2024-04-16T01:17:28Z" level=debug msg="splitting '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/iconvert-inputfile.yaml' into individual files in '/tmp/iconvert3561298153'... "
time="2024-04-16T01:17:28Z" level=info msg="Using ConfigFile @ /.convert-config.yaml"
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'Ingress' with ApiVersion 'networking.k8s.io/v1'..."
time="2024-04-16T01:17:28Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'Ingress' with ApiVersion 'networking.k8s.io/v1' on 'Ingress-i4eappservice-rollout-ingress.yaml'"
time="2024-04-16T01:17:28Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version networking.k8s.io/v1 -f /tmp/iconvert3561298153/Ingress-i4eappservice-rollout-ingress-copy.yaml"
time="2024-04-16T01:17:28Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{"loadBalancer": Map{}},

time="2024-04-16T01:17:28Z" level=debug msg="showing differences generated by provided Processor for kind: 'Ingress'"

time="2024-04-16T01:17:28Z" level=debug msg="removing tmp file '/tmp/iconvert3561298153/Ingress-i4eappservice-rollout-ingress-copy.yaml'"
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'Role' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:17:28Z" level=info msg="Resource 'Role' not found skipping ..."
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'RoleBinding' with ApiVersion 'rbac.authorization.k8s.io/v1'..."
time="2024-04-16T01:17:28Z" level=info msg="Resource 'RoleBinding' not found skipping ..."
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'PodDisruptionBudget' with ApiVersion 'policy/v1'..."
time="2024-04-16T01:17:28Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'PodDisruptionBudget' with ApiVersion 'policy/v1' on 'PodDisruptionBudget-i4eappservice-pdb.yaml'"
time="2024-04-16T01:17:28Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version policy/v1 -f /tmp/iconvert3561298153/PodDisruptionBudget-i4eappservice-pdb-copy.yaml"
time="2024-04-16T01:17:28Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": Map{
- 		"currentHealthy":     Number(0),
- 		"desiredHealthy":     Number(0),
- 		"disruptionsAllowed": Number(0),
- 		"expectedPods":       Number(0),
- 	},

time="2024-04-16T01:17:28Z" level=debug msg="removing tmp file '/tmp/iconvert3561298153/PodDisruptionBudget-i4eappservice-pdb-copy.yaml'"
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2'..."
time="2024-04-16T01:17:28Z" level=debug msg="running '/usr/local/bin/kubectl-convert' for 'HorizontalPodAutoscaler' with ApiVersion 'autoscaling/v2' on 'HorizontalPodAutoscaler-i4eappservice-rollout-hpa.yaml'"
time="2024-04-16T01:17:28Z" level=debug msg="/usr/local/bin/kubectl-convert --show-managed-fields false --validate strict --output-version autoscaling/v2 -f /tmp/iconvert3561298153/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml"
time="2024-04-16T01:17:28Z" level=debug msg="showing differences generated by PostKubectlConvertProcessor"
- 		"creationTimestamp": nil,
- 	"status": map[String]interface{}{"currentMetrics": nil, "desiredReplicas": Number(0)},

time="2024-04-16T01:17:28Z" level=debug msg="removing tmp file '/tmp/iconvert3561298153/HorizontalPodAutoscaler-i4eappservice-rollout-hpa-copy.yaml'"
time="2024-04-16T01:17:28Z" level=info msg="updating Kind 'CronJob' with ApiVersion 'batch/v1'..."
time="2024-04-16T01:17:28Z" level=info msg="Resource 'CronJob' not found skipping ..."
time="2024-04-16T01:17:28Z" level=debug msg="running '/usr/local/bin/kustomize-v4.5.5' in '/tmp/iconvert3561298153' to unify files"
time="2024-04-16T01:17:28Z" level=debug msg="/usr/local/bin/kustomize-v4.5.5 build /tmp/iconvert3561298153"
time="2024-04-16T01:17:28Z" level=debug msg="creating temporary rendered file at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
time="2024-04-16T01:17:28Z" level=info msg="showing differences:"

apiVersion  (PodDisruptionBudget/default/i4eappservice-pdb)
  ± value change
    - policy/v1beta1
    + policy/v1

apiVersion  (HorizontalPodAutoscaler/default/i4eappservice-rollout-hpa)
  ± value change
    - autoscaling/v2beta2
    + autoscaling/v2

time="2024-04-16T01:17:28Z" level=debug msg="removing temporary rendered file generated at '/home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp/generated-iconvert-inputfile.yaml'"
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master
[Pipeline] {
[Pipeline] echo
renderManifest returning iconvert output
[Pipeline] }
[Pipeline] // dir
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prf-usw2-eks
[Pipeline] {
[Pipeline] echo
Integration test disabled. Resetting files.
[Pipeline] echo
Resetting integration test file IntegrationTest.yaml
[Pipeline] sh
+ git restore IntegrationTest.yaml
[Pipeline] echo
Resetting integration test file kustomization.yaml
[Pipeline] sh
+ git restore kustomization.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git rev-parse --abbrev-ref HEAD
[Pipeline] sh
+ git status -s
+ wc -l
[Pipeline] sh
+ git log '--format="%H"' -n 1
+ tail -n 1
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:17:31.942185638
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-****
Warning: JENKINS-30600: special launcher org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator$1@16a8cce1; decorates RemoteLauncher[hudson.remoting.Channel@49b3daf0:JNLP4-connect connection from ip-10-47-6-247.us-west-2.compute.internal/10.47.6.247:43022] will be ignored (a typical symptom is the Git executable not being run inside a designated container)
Fetching changes from the remote Git repository
Checking out Revision 1636d4387e16787e32e0e643e972dddf97a934ce (refs/remotes/origin/master)
Commit message: "Merge pull request #21 from learning-learnexp/neil-prod-min-increase"
 > git rev-parse --resolve-git-dir /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/.git # timeout=10
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-****
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D master # timeout=10
 > git checkout -b master 1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
[Pipeline] sh
++ git config --global user.email
+ result=MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
+ echo MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
[Pipeline] sh
++ git config --global user.name
+ result=MSaaSServiceAccount
+ echo MSaaSServiceAccount
[Pipeline] sh
+ git fetch
[Pipeline] sh
+ git branch -r
[Pipeline] echo
branches: [origin/environments/e2e-usw2-eks, origin/environments/prd-usw2-eks, origin/environments/prf-usw2-eks, origin/environments/qal-usw2-eks, origin/environments/stg-usw2-eks, origin/klir_2023_12_04_16_18_16, origin/master, origin/master-pending, origin/neil-s3]
[Pipeline] sh
+ grep -v .git
+ ls -d Jenkinsfile Jenkinsfile.pci README.md app-base environments msaas-deployment-config.yaml .git '..?*'
+ xargs -I % rm -rf %
ls: cannot access '..?*': No such file or directory
[Pipeline] sh
+ rm -rf .gitpod.yml
[Pipeline] sh
+ git checkout master-pending --
Switched to a new branch 'master-pending'
Branch 'master-pending' set up to track remote branch 'master-pending' from 'origin'.
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/qal-usw2-eks
[Pipeline] {
[Pipeline] sh
+ rm -f manifest.yaml
[Pipeline] writeFile
[Pipeline] fileExists
[Pipeline] sh
+ ls /policyguard
/policyguard
[Pipeline] echo
Starting Policy Guard
[Pipeline] sh
+ rm -rf policyguard.qal-usw2-eks.txt
[Pipeline] sh
+ /policyguard version
[Pipeline] echo
Invoking Policy Guard scan using v1.2.0

[Pipeline] sh
+ /policyguard scan manifest.yaml --type k8s --server policyguard-grpc-ext.policyengine.v2.prd.a.intuit.com:443 --out-format human --asset-id 2597468678172884775 --repo https://github.intuit.com/learning-learnexp/i4eappservice.git --labels source=msaas-custom,commit_id=1636d4387e16787e32e0e643e972dddf97a934ce,build_url=https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/,service_environment=qal-usw2-eks,cluster_name=https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com,namespace=learning-learnexp-i4eappservice-usw2-qal,region=usw2,iks_type=ppd,asset_alias=Intuit.learning.learnexp.i4eappservice,asset_name=i4eappservice,notification_by=ALL,notification_type=WARNING
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] readFile
[Pipeline] sh
+ rm -rf policyguard.qal-usw2-eks.txt
[Pipeline] echo
Policy Guard scan result
Infrastructure code scan result:

Summary: 0 passed, 0 violations, 0 warnings, 0 waived
Request ID: 79dc574f-f5fb-4c24-9047-9b815f51f7df
Scan Result URL: https://policyguard-api.policyengine.v2.prd.a.intuit.com/v1/policyguard/scan-results/3270771
Additional Info: To learn more about Policy Guard, how to fix violations and warnings, or how to ask for exceptions, visit: https://devportal.intuit.com/app/dp/capability/hlr1jrqaxo0k7dl9gill/capabilityDocs/main/docs/overview.md.
For violations related to K8S, reach out to #cmty-reliability-compliance slack channel: https://intuit-teams.slack.com/archives/C04G148RPMF.
For violations related to cloud resources, reach out to #team-aws-help slack channel: https://intuit-teams.slack.com/archives/C568JD2P7.

[Pipeline] sh
+ git add manifest.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git add environments/qal-usw2-eks/manifest.yaml
[Pipeline] sh
+ git diff -U0 origin/environments/qal-usw2-eks -- manifest.yaml environments/qal-usw2-eks/manifest.yaml
[Pipeline] echo
Could not generate manifest diff. Reason: java.lang.IndexOutOfBoundsException: toIndex = 8
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/e2e-usw2-eks
[Pipeline] {
[Pipeline] sh
+ rm -f manifest.yaml
[Pipeline] writeFile
[Pipeline] fileExists
[Pipeline] sh
+ ls /policyguard
/policyguard
[Pipeline] echo
Starting Policy Guard
[Pipeline] sh
+ rm -rf policyguard.e2e-usw2-eks.txt
[Pipeline] sh
+ /policyguard version
[Pipeline] echo
Invoking Policy Guard scan using v1.2.0

[Pipeline] sh
+ /policyguard scan manifest.yaml --type k8s --server policyguard-grpc-ext.policyengine.v2.prd.a.intuit.com:443 --out-format human --asset-id 2597468678172884775 --repo https://github.intuit.com/learning-learnexp/i4eappservice.git --labels source=msaas-custom,commit_id=1636d4387e16787e32e0e643e972dddf97a934ce,build_url=https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/,service_environment=e2e-usw2-eks,cluster_name=https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com,namespace=learning-learnexp-i4eappservice-usw2-e2e,region=usw2,iks_type=ppd,asset_alias=Intuit.learning.learnexp.i4eappservice,asset_name=i4eappservice,notification_by=ALL,notification_type=WARNING
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] readFile
[Pipeline] sh
+ rm -rf policyguard.e2e-usw2-eks.txt
[Pipeline] echo
Policy Guard scan result
Infrastructure code scan result:

Summary: 0 passed, 0 violations, 0 warnings, 0 waived
Request ID: 667227ac-e520-4902-b57a-206b031d0ee7
Scan Result URL: https://policyguard-api.policyengine.v2.prd.a.intuit.com/v1/policyguard/scan-results/3270772
Additional Info: To learn more about Policy Guard, how to fix violations and warnings, or how to ask for exceptions, visit: https://devportal.intuit.com/app/dp/capability/hlr1jrqaxo0k7dl9gill/capabilityDocs/main/docs/overview.md.
For violations related to K8S, reach out to #cmty-reliability-compliance slack channel: https://intuit-teams.slack.com/archives/C04G148RPMF.
For violations related to cloud resources, reach out to #team-aws-help slack channel: https://intuit-teams.slack.com/archives/C568JD2P7.

[Pipeline] sh
+ git add manifest.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git add environments/e2e-usw2-eks/manifest.yaml
[Pipeline] sh
+ git diff -U0 origin/environments/e2e-usw2-eks -- manifest.yaml environments/e2e-usw2-eks/manifest.yaml
[Pipeline] echo
Could not generate manifest diff. Reason: java.lang.IndexOutOfBoundsException: toIndex = 8
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/stg-usw2-eks
[Pipeline] {
[Pipeline] sh
+ rm -f manifest.yaml
[Pipeline] writeFile
[Pipeline] fileExists
[Pipeline] sh
+ ls /policyguard
/policyguard
[Pipeline] echo
Starting Policy Guard
[Pipeline] sh
+ rm -rf policyguard.stg-usw2-eks.txt
[Pipeline] sh
+ /policyguard version
[Pipeline] echo
Invoking Policy Guard scan using v1.2.0

[Pipeline] sh
+ /policyguard scan manifest.yaml --type k8s --server policyguard-grpc-ext.policyengine.v2.prd.a.intuit.com:443 --out-format human --asset-id 2597468678172884775 --repo https://github.intuit.com/learning-learnexp/i4eappservice.git --labels source=msaas-custom,commit_id=1636d4387e16787e32e0e643e972dddf97a934ce,build_url=https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/,service_environment=stg-usw2-eks,cluster_name=https://eksapi-futures-prd-usw2-k8s-c68549fa99088f10.elb.us-west-2.amazonaws.com,namespace=learning-learnexp-i4eappservice-usw2-stg,region=usw2,iks_type=prd,asset_alias=Intuit.learning.learnexp.i4eappservice,asset_name=i4eappservice,notification_by=ALL,notification_type=WARNING
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] readFile
[Pipeline] sh
+ rm -rf policyguard.stg-usw2-eks.txt
[Pipeline] echo
Policy Guard scan result
Infrastructure code scan result:

Summary: 0 passed, 0 violations, 0 warnings, 0 waived
Request ID: 6a10e702-a531-4bf9-afb2-6b439de1b995
Scan Result URL: https://policyguard-api.policyengine.v2.prd.a.intuit.com/v1/policyguard/scan-results/3270773
Additional Info: To learn more about Policy Guard, how to fix violations and warnings, or how to ask for exceptions, visit: https://devportal.intuit.com/app/dp/capability/hlr1jrqaxo0k7dl9gill/capabilityDocs/main/docs/overview.md.
For violations related to K8S, reach out to #cmty-reliability-compliance slack channel: https://intuit-teams.slack.com/archives/C04G148RPMF.
For violations related to cloud resources, reach out to #team-aws-help slack channel: https://intuit-teams.slack.com/archives/C568JD2P7.

[Pipeline] sh
+ git add manifest.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git add environments/stg-usw2-eks/manifest.yaml
[Pipeline] sh
+ git diff -U0 origin/environments/stg-usw2-eks -- manifest.yaml environments/stg-usw2-eks/manifest.yaml
[Pipeline] echo
Could not generate manifest diff. Reason: java.lang.IndexOutOfBoundsException: toIndex = 8
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prd-usw2-eks
[Pipeline] {
[Pipeline] sh
+ rm -f manifest.yaml
[Pipeline] writeFile
[Pipeline] fileExists
[Pipeline] sh
+ ls /policyguard
/policyguard
[Pipeline] echo
Starting Policy Guard
[Pipeline] sh
+ rm -rf policyguard.prd-usw2-eks.txt
[Pipeline] sh
+ /policyguard version
[Pipeline] echo
Invoking Policy Guard scan using v1.2.0

[Pipeline] sh
+ /policyguard scan manifest.yaml --type k8s --server policyguard-grpc-ext.policyengine.v2.prd.a.intuit.com:443 --out-format human --asset-id 2597468678172884775 --repo https://github.intuit.com/learning-learnexp/i4eappservice.git --labels source=msaas-custom,commit_id=1636d4387e16787e32e0e643e972dddf97a934ce,build_url=https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/,service_environment=prd-usw2-eks,cluster_name=https://eksapi-futures-prd-usw2-k8s-c68549fa99088f10.elb.us-west-2.amazonaws.com,namespace=learning-learnexp-i4eappservice-usw2-prd,region=usw2,iks_type=prd,asset_alias=Intuit.learning.learnexp.i4eappservice,asset_name=i4eappservice,notification_by=ALL,notification_type=WARNING
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] readFile
[Pipeline] sh
+ rm -rf policyguard.prd-usw2-eks.txt
[Pipeline] echo
Policy Guard scan result
Infrastructure code scan result:

Summary: 0 passed, 0 violations, 0 warnings, 0 waived
Request ID: 68e0be95-b8b3-45d0-937e-33ef2cfd2b39
Scan Result URL: https://policyguard-api.policyengine.v2.prd.a.intuit.com/v1/policyguard/scan-results/3270774
Additional Info: To learn more about Policy Guard, how to fix violations and warnings, or how to ask for exceptions, visit: https://devportal.intuit.com/app/dp/capability/hlr1jrqaxo0k7dl9gill/capabilityDocs/main/docs/overview.md.
For violations related to K8S, reach out to #cmty-reliability-compliance slack channel: https://intuit-teams.slack.com/archives/C04G148RPMF.
For violations related to cloud resources, reach out to #team-aws-help slack channel: https://intuit-teams.slack.com/archives/C568JD2P7.

[Pipeline] sh
+ git add manifest.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git add environments/prd-usw2-eks/manifest.yaml
[Pipeline] sh
+ git diff -U0 origin/environments/prd-usw2-eks -- manifest.yaml environments/prd-usw2-eks/manifest.yaml
[Pipeline] echo
Manifest Diff - environments/prd-usw2-eks
@@ -552 +552 @@ spec:
-  minReplicas: 5
+  minReplicas: 10
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce/environments/prf-usw2-eks
[Pipeline] {
[Pipeline] sh
+ rm -f manifest.yaml
[Pipeline] writeFile
[Pipeline] fileExists
[Pipeline] sh
+ ls /policyguard
/policyguard
[Pipeline] echo
Starting Policy Guard
[Pipeline] sh
+ rm -rf policyguard.prf-usw2-eks.txt
[Pipeline] sh
+ /policyguard version
[Pipeline] echo
Invoking Policy Guard scan using v1.2.0

[Pipeline] sh
+ /policyguard scan manifest.yaml --type k8s --server policyguard-grpc-ext.policyengine.v2.prd.a.intuit.com:443 --out-format human --asset-id 2597468678172884775 --repo https://github.intuit.com/learning-learnexp/i4eappservice.git --labels source=msaas-custom,commit_id=1636d4387e16787e32e0e643e972dddf97a934ce,build_url=https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/,service_environment=prf-usw2-eks,cluster_name=https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com,namespace=learning-learnexp-i4eappservice-usw2-prf,region=usw2,iks_type=ppd,asset_alias=Intuit.learning.learnexp.i4eappservice,asset_name=i4eappservice,notification_by=ALL,notification_type=WARNING
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] readFile
[Pipeline] sh
+ rm -rf policyguard.prf-usw2-eks.txt
[Pipeline] echo
Policy Guard scan result
Infrastructure code scan result:

Summary: 0 passed, 0 violations, 0 warnings, 0 waived
Request ID: d95e2dff-5f01-4343-9620-998c3f98fc2f
Scan Result URL: https://policyguard-api.policyengine.v2.prd.a.intuit.com/v1/policyguard/scan-results/3270775
Additional Info: To learn more about Policy Guard, how to fix violations and warnings, or how to ask for exceptions, visit: https://devportal.intuit.com/app/dp/capability/hlr1jrqaxo0k7dl9gill/capabilityDocs/main/docs/overview.md.
For violations related to K8S, reach out to #cmty-reliability-compliance slack channel: https://intuit-teams.slack.com/archives/C04G148RPMF.
For violations related to cloud resources, reach out to #team-aws-help slack channel: https://intuit-teams.slack.com/archives/C568JD2P7.

[Pipeline] sh
+ git add manifest.yaml
[Pipeline] }
[Pipeline] // dir
[Pipeline] sh
+ git add environments/prf-usw2-eks/manifest.yaml
[Pipeline] sh
+ git diff -U0 origin/environments/prf-usw2-eks -- manifest.yaml environments/prf-usw2-eks/manifest.yaml
[Pipeline] echo
Manifest Diff - environments/prf-usw2-eks
@@ -454 +454 @@ spec:
-        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-fe0c6ce
+        image: docker.intuit.com/learning-learnexp/i4eappservice/service/i4eappservice:master-9b0d439
[Pipeline] sh
+ git rev-parse --abbrev-ref HEAD
[Pipeline] sh
+ git status -s
+ wc -l
[Pipeline] sh
+ git commit -am '[Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]'
[master-pending 7f4dd59] [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
 1 file changed, 1 insertion(+), 1 deletion(-)
[Pipeline] lock
Trying to acquire lock on [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
Resource [github.intuit.com/learning-learnexp/i4eappservice-deployment.git] did not exist. Created.
Lock acquired on [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
[Pipeline] {
[Pipeline] timeout
Timeout set to expire in 10 min
[Pipeline] {
[Pipeline] sh
+ git pull --rebase https://****:****@github.intuit.com/learning-learnexp/i4eappservice-deployment.git master-pending
From https://github.intuit.com/learning-learnexp/i4eappservice-deployment
 * branch            master-pending -> FETCH_HEAD
Current branch master-pending is up to date.
[Pipeline] sh
+ git push https://****:****@github.intuit.com/learning-learnexp/i4eappservice-deployment.git master-pending
To https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
   85f3633..7f4dd59  master-pending -> master-pending
[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
Lock released on resource [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
[Pipeline] // lock
[Pipeline] sh
+ git log '--format="%H"' -n 1
+ tail -n 1
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
Saving last deployment commit id as 7f4dd597a309343dec520c3c8cf94ecc79d13886
[Pipeline] echo
FYI for restarting: version=null image_full_name=null restart_from_build=725 restart_chkpt_time=2024-04-16 01:18:13 (local)
[Pipeline] writeYaml
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
Archived 'msaasConfig' in artifact: msaas-config_restart-archive.yaml
[Pipeline] echo
FYI for restarting: version=null image_full_name=null restart_from_build=725 restart_chkpt_time=2024-04-16 01:18:13 (local)
[Pipeline] writeYaml
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
Archived 'msaasConfig' in artifact: msaas-config_restart-archive.yaml
[Pipeline] sh
+ rm -rf deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce deployment-all-1636d4387e16787e32e0e643e972dddf97a934ce@tmp
[Pipeline] }
Lock released on resource [2597468678172884775-manifests-all]
[Pipeline] // lock
[Pipeline] }
Lock released on resource [2597468678172884775-deploy]
[Pipeline] // lock
[Pipeline] echo
Committing manifest.
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:18:14.639304471
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-qal-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-****
Warning: JENKINS-30600: special launcher org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator$1@50431f10; decorates RemoteLauncher[hudson.remoting.Channel@49b3daf0:JNLP4-connect connection from ip-10-47-6-247.us-west-2.compute.internal/10.47.6.247:43022] will be ignored (a typical symptom is the Git executable not being run inside a designated container)
Cloning the remote Git repository
Avoid second fetch
Checking out Revision 7f4dd597a309343dec520c3c8cf94ecc79d13886 (refs/remotes/origin/master-pending)
Commit message: "[Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]"
Cloning repository https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git init /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-qal-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-****
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master-pending^{commit} # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master-pending 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
 > git rev-list --no-walk 3107bff41f36bf4c2f54cbdf0c6e3f8c1163a230 # timeout=10
[Pipeline] sh
++ git config --global user.email
+ result=MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
+ echo MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
[Pipeline] sh
++ git config --global user.name
+ result=MSaaSServiceAccount
+ echo MSaaSServiceAccount
[Pipeline] sh
+ git checkout 7f4dd597a309343dec520c3c8cf94ecc79d13886
Note: switching to '7f4dd597a309343dec520c3c8cf94ecc79d13886'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
[Pipeline] readFile
[Pipeline] sh
+ git fetch
[Pipeline] sh
+ git branch -r
[Pipeline] echo
branches: [origin/environments/e2e-usw2-eks, origin/environments/prd-usw2-eks, origin/environments/prf-usw2-eks, origin/environments/qal-usw2-eks, origin/environments/stg-usw2-eks, origin/klir_2023_12_04_16_18_16, origin/master, origin/master-pending, origin/neil-s3]
[Pipeline] sh
+ ls -d environments .git '..?*'
+ grep -v .git
+ xargs -I % rm -rf %
ls: cannot access '..?*': No such file or directory
[Pipeline] sh
+ rm -rf .gitpod.yml
[Pipeline] sh
+ git checkout environments/qal-usw2-eks --
Previous HEAD position was 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
Switched to a new branch 'environments/qal-usw2-eks'
Branch 'environments/qal-usw2-eks' set up to track remote branch 'environments/qal-usw2-eks' from 'origin'.
[Pipeline] writeFile
[Pipeline] sh
+ git add manifest.yaml
[Pipeline] sh
+ git rev-parse --abbrev-ref HEAD
[Pipeline] sh
+ git status -s
+ wc -l
[Pipeline] sh
+ git log '--format="%H"' -n 1
+ tail -n 1
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
Starting Argo sync.
[Pipeline] echo
Auto-Open CR: qal-usw2-eks is not prod. Skipping
[Pipeline] sh
+ echo running argocd sync with Project Token
running argocd sync with Project Token
[Pipeline] withCredentials
Masking supported pattern matches of $ARGOCD_AUTH_TOKEN
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ /argocd --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-qal --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-qal --upsert --revision environments/qal-usw2-eks
+ '[' --server = login ']'
+ SRC_ARGS='--server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-qal --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-qal --upsert --revision environments/qal-usw2-eks'
+ '[' '!' -f /tmp/argocd-cli ']'
+ '[' 19 -gt 0 ']'
+ case "$1" in
+ shift
+ download_argocd futures.argocd.tools-k8s-prd.a.intuit.com:443
+ platform=darwin
++ uname
+ unamestr=Linux
++ uname -m
+ archtypestr=x86_64
+ archtype=amd64
+ DOWNLOAD_URL=
+ [[ Linux == \L\i\n\u\x ]]
+ platform=linux
+ [[ x86_64 == \a\a\r\c\h\6\4 ]]
+ archtype=amd64
+ DOWNLOAD_URL=https://futures.argocd.tools-k8s-prd.a.intuit.com:443/download/argocd-linux-amd64
+ DOWNLOAD_LOCAL_PATH=/tmp/argocd-cli-19161
+ echo 'Downloading argocd cli linux of arch type amd64 from https://futures.argocd.tools-k8s-prd.a.intuit.com:443/download/argocd-linux-amd64 to /tmp/argocd-cli-19161'
Downloading argocd cli linux of arch type amd64 from https://futures.argocd.tools-k8s-prd.a.intuit.com:443/download/argocd-linux-amd64 to /tmp/argocd-cli-19161
+ rm -f /tmp/argocd-cli-19161
+ curl -f -v -J -L -k https://futures.argocd.tools-k8s-prd.a.intuit.com:443/download/argocd-linux-amd64 -o /tmp/argocd-cli-19161
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed

  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 35.165.157.9:443...
* Connected to futures.argocd.tools-k8s-prd.a.intuit.com (35.165.157.9) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: /etc/ssl/certs
} [5 bytes data]
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
} [512 bytes data]
* TLSv1.3 (IN), TLS handshake, Server hello (2):
{ [104 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4027 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server accepted to use h2
* Server certificate:
*  subject: C=US; ST=California; L=San Diego; O=INTUIT INC.; CN=*.argocd.tools-k8s-prd.a.intuit.com
*  start date: Jul  1 00:00:00 2023 GMT
*  expire date: Jul 31 23:59:59 2024 GMT
*  issuer: C=US; O=DigiCert Inc; CN=DigiCert TLS RSA SHA256 2020 CA1
*  SSL certificate verify ok.
* Using HTTP2, server supports multi-use
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
} [5 bytes data]
* Using Stream ID: 1 (easy handle 0x558bb5f34620)
} [5 bytes data]
> GET /download/argocd-linux-amd64 HTTP/2
> Host: futures.argocd.tools-k8s-prd.a.intuit.com
> user-agent: curl/7.74.0
> accept: */*
> 
{ [5 bytes data]
* Connection state changed (MAX_CONCURRENT_STREAMS == 128)!
} [5 bytes data]
< HTTP/2 200 
< date: Tue, 16 Apr 2024 01:18:24 GMT
< content-type: application/octet-stream
< content-length: 153565357
< accept-ranges: bytes
< last-modified: Fri, 02 Feb 2024 19:34:35 GMT
< 
{ [988 bytes data]

100  146M  100  146M    0     0   353M      0 --:--:-- --:--:-- --:--:--  353M
* Connection #0 to host futures.argocd.tools-k8s-prd.a.intuit.com left intact
+ chmod +x /tmp/argocd-cli-19161
+ mv /tmp/argocd-cli-19161 /tmp/argocd-cli
+ shift
+ '[' 17 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 16 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 15 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 14 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 13 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 12 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 11 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 10 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 9 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 8 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 7 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 6 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 5 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 4 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 3 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 2 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 1 -gt 0 ']'
+ case "$1" in
+ shift
+ '[' 0 -gt 0 ']'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-qal --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-qal --upsert --revision environments/qal-usw2-eks --grpc-web
application 'learning-learnexp-i4eappservice-usw2-qal' unchanged
[Pipeline] sh
+ /cd-guard all learning-learnexp-i4eappservice-usw2-qal
+ SRC_ARGS='all learning-learnexp-i4eappservice-usw2-qal'
+ [[ ! -f /tmp/cd-guard-cli ]]
+ ARGOCD_CONFIG=/root/.config/argocd/config
+ [[ -f /root/.config/argocd/config ]]
+ ARGOCD_CONFIG=/root/.argocd/config
+ [[ -f /root/.argocd/config ]]
+ echo 'ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config'
ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config
+ /tmp/cd-guard-cli all learning-learnexp-i4eappservice-usw2-qal --grpc-web
time="2024-04-16T01:18:26Z" level=info msg="Ignore HPA minReplicas Check is "
time="2024-04-16T01:18:26Z" level=info msg="Ignore pod readineess gate Check is "
time="2024-04-16T01:18:26Z" level=info msg="The HorizontalPodAutoscaler:i4eappservice-rollout-hpa is associated with Rollout:i4eappservice-rollout"
time="2024-04-16T01:18:26Z" level=info msg="Rollout:i4eappservice-rollout doesn't have 'spec.replicas', it is managed by HPA, perfect!"
time="2024-04-16T01:18:27Z" level=info msg="PDB label is not equal app = i4eappservice, jacoco-server"
[Pipeline] sh
+ /argocd app sync learning-learnexp-i4eappservice-usw2-qal
+ '[' app = login ']'
+ SRC_ARGS='app sync learning-learnexp-i4eappservice-usw2-qal'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app sync learning-learnexp-i4eappservice-usw2-qal --grpc-web
TIMESTAMP                  GROUP                            KIND                NAMESPACE                                                NAME                     STATUS   HEALTH        HOOK  MESSAGE
2024-04-16T01:18:28+00:00                             ServiceAccount           learning-learnexp-i4eappservice-usw2-qal  workflow-service-account                 Synced                       
2024-04-16T01:18:28+00:00   apps                      Deployment               learning-learnexp-i4eappservice-usw2-qal  jacoco-server-deployment                 Synced  Healthy              
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-memory-utilization         Synced                       
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-pod-restarts               Synced                       
2024-04-16T01:18:28+00:00  argoproj.io                   Rollout               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout                    Synced  Healthy              
2024-04-16T01:18:28+00:00  policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-qal     i4eappservice-pdb                     Synced                       
2024-04-16T01:18:28+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-desired-service            Synced  Healthy              
2024-04-16T01:18:28+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  jacoco-server-service                    Synced  Healthy              
2024-04-16T01:18:28+00:00  rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-qal  workflow-role-binding                    Synced                       
2024-04-16T01:18:28+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-root-service               Synced  Healthy              
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate-include4xx    Synced                       
2024-04-16T01:18:28+00:00  autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-hpa                Synced  Healthy              
2024-04-16T01:18:28+00:00  networking.k8s.io             Ingress               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-ingress            Synced  Healthy              
2024-04-16T01:18:28+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-service-metrics            Synced  Healthy              
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate               Synced                       
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-error-rate                 Synced                       
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-request-latency            Synced                       
2024-04-16T01:18:28+00:00  iammanager.keikoproj.io       Iamrole               learning-learnexp-i4eappservice-usw2-qal               iamrole                     Synced  Healthy              
2024-04-16T01:18:28+00:00  rbac.authorization.k8s.io        Role               learning-learnexp-i4eappservice-usw2-qal         workflow-role                     Synced                       
2024-04-16T01:18:28+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-stable-service             Synced  Healthy              
2024-04-16T01:18:28+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-cpu-utilization            Synced                       
2024-04-16T01:18:30+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-qal               iamrole    Synced  Healthy              iamrole.iammanager.keikoproj.io/iamrole unchanged
2024-04-16T01:18:33+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-qal               iamrole             Synced  Healthy              Role 'k8s-learning-learnexp-i4eappservice-usw2-qal' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-qal' and ID 'AROAQALN7OYFK32KFMQDG'.
2024-04-16T01:18:33+00:00  networking.k8s.io           Ingress  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-ingress    Synced  Healthy              ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-pod-restarts               Synced                       analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-error-rate                 Synced                       analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
2024-04-16T01:18:34+00:00  rbac.authorization.k8s.io        Role               learning-learnexp-i4eappservice-usw2-qal         workflow-role                     Synced                       role.rbac.authorization.k8s.io/workflow-role reconciled. role.rbac.authorization.k8s.io/workflow-role unchanged
2024-04-16T01:18:34+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-desired-service            Synced  Healthy              service/i4eappservice-desired-service unchanged
2024-04-16T01:18:34+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-service-metrics            Synced  Healthy              service/i4eappservice-service-metrics unchanged
2024-04-16T01:18:34+00:00  rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-qal  workflow-role-binding                    Synced                       rolebinding.rbac.authorization.k8s.io/workflow-role-binding reconciled. rolebinding.rbac.authorization.k8s.io/workflow-role-binding unchanged
2024-04-16T01:18:34+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  jacoco-server-service                    Synced  Healthy              service/jacoco-server-service unchanged
2024-04-16T01:18:34+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-stable-service             Synced  Healthy              service/i4eappservice-stable-service unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-memory-utilization         Synced                       analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-request-latency            Synced                       analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
2024-04-16T01:18:34+00:00  policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-qal     i4eappservice-pdb                     Synced                       poddisruptionbudget.policy/i4eappservice-pdb configured
2024-04-16T01:18:34+00:00                             ServiceAccount           learning-learnexp-i4eappservice-usw2-qal  workflow-service-account                 Synced                       serviceaccount/workflow-service-account unchanged
2024-04-16T01:18:34+00:00  argoproj.io                   Rollout               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout                    Synced  Healthy              rollout.argoproj.io/i4eappservice-rollout configured
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate               Synced                       analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
2024-04-16T01:18:34+00:00   apps                      Deployment               learning-learnexp-i4eappservice-usw2-qal  jacoco-server-deployment                 Synced  Healthy              deployment.apps/jacoco-server-deployment unchanged
2024-04-16T01:18:34+00:00  autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-hpa                Synced  Healthy              horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate-include4xx    Synced                       analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
2024-04-16T01:18:34+00:00                                Service               learning-learnexp-i4eappservice-usw2-qal  i4eappservice-root-service               Synced  Healthy              service/i4eappservice-root-service unchanged
2024-04-16T01:18:34+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-cpu-utilization            Synced                       analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
2024-04-16T01:18:34+00:00  argoproj.io     Rollout  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout    Synced  Progressing              rollout.argoproj.io/i4eappservice-rollout configured

Name:               dev-argocd-usw2-futu/learning-learnexp-i4eappservice-usw2-qal
Project:            learning-learnexp-i4eappservice
Server:             https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com
Namespace:          learning-learnexp-i4eappservice-usw2-qal
URL:                https://futures.argocd.tools-k8s-prd.a.intuit.com/applications/learning-learnexp-i4eappservice-usw2-qal
Repo:               https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
Target:             environments/qal-usw2-eks
Path:               .
SyncWindow:         Sync Allowed
Sync Policy:        <none>
Sync Status:        Synced to environments/qal-usw2-eks (4233e11)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      4233e1198dc7f7a562f52abf5cfb020343fffe70
Phase:              Succeeded
Start:              2024-04-16 01:18:27 +0000 UTC
Finished:           2024-04-16 01:18:34 +0000 UTC
Duration:           7s
Message:            successfully synced (all tasks run)

GROUP                      KIND                     NAMESPACE                                 NAME                                   STATUS  HEALTH   HOOK  MESSAGE
iammanager.keikoproj.io    Iamrole                  learning-learnexp-i4eappservice-usw2-qal  iamrole                                Synced  Healthy        Role 'k8s-learning-learnexp-i4eappservice-usw2-qal' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-qal' and ID 'AROAQALN7OYFK32KFMQDG'.
networking.k8s.io          Ingress                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-ingress          Synced  Healthy        ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-qal  i4eappservice-pdb                      Synced                 poddisruptionbudget.policy/i4eappservice-pdb configured
                           ServiceAccount           learning-learnexp-i4eappservice-usw2-qal  workflow-service-account               Synced                 serviceaccount/workflow-service-account unchanged
rbac.authorization.k8s.io  Role                     learning-learnexp-i4eappservice-usw2-qal  workflow-role                          Synced                 role.rbac.authorization.k8s.io/workflow-role reconciled. role.rbac.authorization.k8s.io/workflow-role unchanged
rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-qal  workflow-role-binding                  Synced                 rolebinding.rbac.authorization.k8s.io/workflow-role-binding reconciled. rolebinding.rbac.authorization.k8s.io/workflow-role-binding unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-desired-service          Synced  Healthy        service/i4eappservice-desired-service unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-root-service             Synced  Healthy        service/i4eappservice-root-service unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-service-metrics          Synced  Healthy        service/i4eappservice-service-metrics unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-qal  jacoco-server-service                  Synced  Healthy        service/jacoco-server-service unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-stable-service           Synced  Healthy        service/i4eappservice-stable-service unchanged
apps                       Deployment               learning-learnexp-i4eappservice-usw2-qal  jacoco-server-deployment               Synced  Healthy        deployment.apps/jacoco-server-deployment unchanged
autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout-hpa              Synced  Healthy        horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-memory-utilization       Synced                 analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-pod-restarts             Synced                 analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-request-latency          Synced                 analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-error-rate               Synced                 analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-cpu-utilization          Synced                 analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
argoproj.io                Rollout                  learning-learnexp-i4eappservice-usw2-qal  i4eappservice-rollout                  Synced  Healthy        rollout.argoproj.io/i4eappservice-rollout configured
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate-include4xx  Synced                 analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-qal  i4eappservice-success-rate             Synced                 analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
[Pipeline] sh
+ /argocd app manifests learning-learnexp-i4eappservice-usw2-qal
+ '[' app = login ']'
+ SRC_ARGS='app manifests learning-learnexp-i4eappservice-usw2-qal'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app manifests learning-learnexp-i4eappservice-usw2-qal --grpc-web
[Pipeline] readYaml
[Pipeline] sh
+ /argocd app wait learning-learnexp-i4eappservice-usw2-qal --timeout 1800
+ '[' app = login ']'
+ SRC_ARGS='app wait learning-learnexp-i4eappservice-usw2-qal --timeout 1800'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app wait learning-learnexp-i4eappservice-usw2-qal --timeout 1800 --grpc-web
[Pipeline] echo
syncWPT: "argocd app wait" indicates healthy on first attempt - proceeding
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
{"eventType":"method_invocation","library_method":"gitOpsDeployRenderManifest","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"Deploy","build":"725","exception":"0","exceptionMessage":"","duration":"180502","timeStamp":"1713230316396","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
Lock released on resource [learning-learnexp-i4eappservice-usw2-qal]
[Pipeline] // lock
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (e2e-usw2-eks)
[Pipeline] lock
Trying to acquire lock on [learning-learnexp-i4eappservice-usw2-e2e]
Resource [learning-learnexp-i4eappservice-usw2-e2e] did not exist. Created.
Lock acquired on [learning-learnexp-i4eappservice-usw2-e2e]
[Pipeline] {
[Pipeline] timeout
Timeout set to expire in 22 min
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] container
[Pipeline] {
[Pipeline] echo
FYI for restarting: version=null image_full_name=null restart_from_build=725 restart_chkpt_time=2024-04-16 01:18:36 (local)
[Pipeline] writeYaml
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
Archived 'msaasConfig' in artifact: msaas-config_restart-archive.yaml
[Pipeline] echo
Committing manifest.
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:18:37.404909148
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-e2e-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-****
Warning: JENKINS-30600: special launcher org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator$1@74a27c28; decorates RemoteLauncher[hudson.remoting.Channel@49b3daf0:JNLP4-connect connection from ip-10-47-6-247.us-west-2.compute.internal/10.47.6.247:43022] will be ignored (a typical symptom is the Git executable not being run inside a designated container)
Cloning the remote Git repository
Cloning repository https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git init /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-e2e-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-****
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
Checking out Revision 7f4dd597a309343dec520c3c8cf94ecc79d13886 (refs/remotes/origin/master-pending)
Commit message: "[Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]"
[Pipeline] sh
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master-pending^{commit} # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master-pending 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
++ git config --global user.email
+ result=MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
+ echo MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
[Pipeline] sh
++ git config --global user.name
+ result=MSaaSServiceAccount
+ echo MSaaSServiceAccount
[Pipeline] sh
+ git checkout 7f4dd597a309343dec520c3c8cf94ecc79d13886
Note: switching to '7f4dd597a309343dec520c3c8cf94ecc79d13886'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
[Pipeline] readFile
[Pipeline] sh
+ git fetch
[Pipeline] sh
+ git branch -r
[Pipeline] echo
branches: [origin/environments/e2e-usw2-eks, origin/environments/prd-usw2-eks, origin/environments/prf-usw2-eks, origin/environments/qal-usw2-eks, origin/environments/stg-usw2-eks, origin/klir_2023_12_04_16_18_16, origin/master, origin/master-pending, origin/neil-s3]
[Pipeline] sh
+ grep -v .git
+ ls -d environments .git '..?*'
+ xargs -I % rm -rf %
ls: cannot access '..?*': No such file or directory
[Pipeline] sh
+ rm -rf .gitpod.yml
[Pipeline] sh
+ git checkout environments/e2e-usw2-eks --
Previous HEAD position was 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
Switched to a new branch 'environments/e2e-usw2-eks'
Branch 'environments/e2e-usw2-eks' set up to track remote branch 'environments/e2e-usw2-eks' from 'origin'.
[Pipeline] writeFile
[Pipeline] sh
+ git add manifest.yaml
[Pipeline] sh
+ git rev-parse --abbrev-ref HEAD
[Pipeline] sh
+ git status -s
+ wc -l
[Pipeline] sh
+ git log '--format="%H"' -n 1
+ tail -n 1
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
Starting Argo sync.
[Pipeline] echo
Auto-Open CR: e2e-usw2-eks is not prod. Skipping
[Pipeline] sh
+ echo running argocd sync with Project Token
running argocd sync with Project Token
[Pipeline] withCredentials
Masking supported pattern matches of $ARGOCD_AUTH_TOKEN
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ /argocd --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-e2e --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-e2e --upsert --revision environments/e2e-usw2-eks
+ '[' --server = login ']'
+ SRC_ARGS='--server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-e2e --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-e2e --upsert --revision environments/e2e-usw2-eks'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-e2e --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-e2e --upsert --revision environments/e2e-usw2-eks --grpc-web
application 'learning-learnexp-i4eappservice-usw2-e2e' unchanged
[Pipeline] sh
+ /cd-guard all learning-learnexp-i4eappservice-usw2-e2e
+ SRC_ARGS='all learning-learnexp-i4eappservice-usw2-e2e'
+ [[ ! -f /tmp/cd-guard-cli ]]
+ ARGOCD_CONFIG=/root/.config/argocd/config
+ [[ -f /root/.config/argocd/config ]]
+ ARGOCD_CONFIG=/root/.argocd/config
+ [[ -f /root/.argocd/config ]]
+ echo 'ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config'
ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config
+ /tmp/cd-guard-cli all learning-learnexp-i4eappservice-usw2-e2e --grpc-web
time="2024-04-16T01:18:49Z" level=info msg="Ignore HPA minReplicas Check is "
time="2024-04-16T01:18:49Z" level=info msg="Ignore pod readineess gate Check is "
time="2024-04-16T01:18:50Z" level=info msg="The HorizontalPodAutoscaler:i4eappservice-rollout-hpa is associated with Rollout:i4eappservice-rollout"
time="2024-04-16T01:18:50Z" level=info msg="Rollout:i4eappservice-rollout doesn't have 'spec.replicas', it is managed by HPA, perfect!"
[Pipeline] sh
+ /argocd app sync learning-learnexp-i4eappservice-usw2-e2e
+ '[' app = login ']'
+ SRC_ARGS='app sync learning-learnexp-i4eappservice-usw2-e2e'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app sync learning-learnexp-i4eappservice-usw2-e2e --grpc-web
TIMESTAMP                  GROUP                            KIND                NAMESPACE                                                NAME                     STATUS   HEALTH        HOOK  MESSAGE
2024-04-16T01:18:51+00:00                             ServiceAccount           learning-learnexp-i4eappservice-usw2-e2e  workflow-service-account                 Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-memory-utilization         Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-pod-restarts               Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-request-latency            Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                   Rollout               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout                    Synced  Healthy              
2024-04-16T01:18:51+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-root-service               Synced  Healthy              
2024-04-16T01:18:51+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-service-metrics            Synced  Healthy              
2024-04-16T01:18:51+00:00  autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-hpa                Synced  Healthy              
2024-04-16T01:18:51+00:00  networking.k8s.io             Ingress               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-ingress            Synced  Healthy              
2024-04-16T01:18:51+00:00  policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-e2e     i4eappservice-pdb                     Synced                       
2024-04-16T01:18:51+00:00  rbac.authorization.k8s.io        Role               learning-learnexp-i4eappservice-usw2-e2e         workflow-role                     Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-cpu-utilization            Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate               Synced                       
2024-04-16T01:18:51+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-desired-service            Synced  Healthy              
2024-04-16T01:18:51+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-stable-service             Synced  Healthy              
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-error-rate                 Synced                       
2024-04-16T01:18:51+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate-include4xx    Synced                       
2024-04-16T01:18:51+00:00  iammanager.keikoproj.io       Iamrole               learning-learnexp-i4eappservice-usw2-e2e               iamrole                     Synced  Healthy              
2024-04-16T01:18:51+00:00  rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-e2e  workflow-role-binding                    Synced                       
2024-04-16T01:18:53+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-e2e               iamrole    Synced  Healthy              iamrole.iammanager.keikoproj.io/iamrole unchanged
2024-04-16T01:18:56+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-e2e               iamrole             Synced  Healthy              Role 'k8s-learning-learnexp-i4eappservice-usw2-e2e' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-e2e' and ID 'AROAQALN7OYFCIZR62SWO'.
2024-04-16T01:18:56+00:00  networking.k8s.io           Ingress  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-ingress    Synced  Healthy              ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-error-rate                 Synced                       analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
2024-04-16T01:18:56+00:00  argoproj.io                   Rollout               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout                    Synced  Healthy              rollout.argoproj.io/i4eappservice-rollout configured
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate-include4xx    Synced                       analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate               Synced                       analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
2024-04-16T01:18:56+00:00  rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-e2e  workflow-role-binding                    Synced                       rolebinding.rbac.authorization.k8s.io/workflow-role-binding reconciled. rolebinding.rbac.authorization.k8s.io/workflow-role-binding unchanged
2024-04-16T01:18:56+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-desired-service            Synced  Healthy              service/i4eappservice-desired-service unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-pod-restarts               Synced                       analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
2024-04-16T01:18:56+00:00  autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-hpa                Synced  Healthy              horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
2024-04-16T01:18:56+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-stable-service             Synced  Healthy              service/i4eappservice-stable-service unchanged
2024-04-16T01:18:56+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-root-service               Synced  Healthy              service/i4eappservice-root-service unchanged
2024-04-16T01:18:56+00:00  policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-e2e     i4eappservice-pdb                     Synced                       poddisruptionbudget.policy/i4eappservice-pdb configured
2024-04-16T01:18:56+00:00                                Service               learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-service-metrics            Synced  Healthy              service/i4eappservice-service-metrics unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-request-latency            Synced                       analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-memory-utilization         Synced                       analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
2024-04-16T01:18:56+00:00  argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-cpu-utilization            Synced                       analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
2024-04-16T01:18:56+00:00                             ServiceAccount           learning-learnexp-i4eappservice-usw2-e2e  workflow-service-account                 Synced                       serviceaccount/workflow-service-account unchanged
2024-04-16T01:18:56+00:00  rbac.authorization.k8s.io        Role               learning-learnexp-i4eappservice-usw2-e2e         workflow-role                     Synced                       role.rbac.authorization.k8s.io/workflow-role reconciled. role.rbac.authorization.k8s.io/workflow-role unchanged
2024-04-16T01:18:56+00:00  argoproj.io     Rollout  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout    Synced  Progressing              rollout.argoproj.io/i4eappservice-rollout configured

Name:               dev-argocd-usw2-futu/learning-learnexp-i4eappservice-usw2-e2e
Project:            learning-learnexp-i4eappservice
Server:             https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com
Namespace:          learning-learnexp-i4eappservice-usw2-e2e
URL:                https://futures.argocd.tools-k8s-prd.a.intuit.com/applications/learning-learnexp-i4eappservice-usw2-e2e
Repo:               https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
Target:             environments/e2e-usw2-eks
Path:               .
SyncWindow:         Sync Allowed
Sync Policy:        <none>
Sync Status:        Synced to environments/e2e-usw2-eks (eace4af)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      eace4af1ec184f34360d92f17345ff322f6fd3d4
Phase:              Succeeded
Start:              2024-04-16 01:18:51 +0000 UTC
Finished:           2024-04-16 01:18:56 +0000 UTC
Duration:           5s
Message:            successfully synced (all tasks run)

GROUP                      KIND                     NAMESPACE                                 NAME                                   STATUS  HEALTH   HOOK  MESSAGE
iammanager.keikoproj.io    Iamrole                  learning-learnexp-i4eappservice-usw2-e2e  iamrole                                Synced  Healthy        Role 'k8s-learning-learnexp-i4eappservice-usw2-e2e' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-e2e' and ID 'AROAQALN7OYFCIZR62SWO'.
networking.k8s.io          Ingress                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-ingress          Synced  Healthy        ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
policy                     PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-pdb                      Synced                 poddisruptionbudget.policy/i4eappservice-pdb configured
                           ServiceAccount           learning-learnexp-i4eappservice-usw2-e2e  workflow-service-account               Synced                 serviceaccount/workflow-service-account unchanged
rbac.authorization.k8s.io  Role                     learning-learnexp-i4eappservice-usw2-e2e  workflow-role                          Synced                 role.rbac.authorization.k8s.io/workflow-role reconciled. role.rbac.authorization.k8s.io/workflow-role unchanged
rbac.authorization.k8s.io  RoleBinding              learning-learnexp-i4eappservice-usw2-e2e  workflow-role-binding                  Synced                 rolebinding.rbac.authorization.k8s.io/workflow-role-binding reconciled. rolebinding.rbac.authorization.k8s.io/workflow-role-binding unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-service-metrics          Synced  Healthy        service/i4eappservice-service-metrics unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-desired-service          Synced  Healthy        service/i4eappservice-desired-service unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-stable-service           Synced  Healthy        service/i4eappservice-stable-service unchanged
                           Service                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-root-service             Synced  Healthy        service/i4eappservice-root-service unchanged
autoscaling                HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout-hpa              Synced  Healthy        horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-pod-restarts             Synced                 analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-request-latency          Synced                 analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-memory-utilization       Synced                 analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-cpu-utilization          Synced                 analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-error-rate               Synced                 analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
argoproj.io                Rollout                  learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-rollout                  Synced  Healthy        rollout.argoproj.io/i4eappservice-rollout configured
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate-include4xx  Synced                 analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
argoproj.io                AnalysisTemplate         learning-learnexp-i4eappservice-usw2-e2e  i4eappservice-success-rate             Synced                 analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
[Pipeline] sh
+ /argocd app manifests learning-learnexp-i4eappservice-usw2-e2e
+ '[' app = login ']'
+ SRC_ARGS='app manifests learning-learnexp-i4eappservice-usw2-e2e'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app manifests learning-learnexp-i4eappservice-usw2-e2e --grpc-web
[Pipeline] readYaml
[Pipeline] sh
+ /argocd app wait learning-learnexp-i4eappservice-usw2-e2e --timeout 1800
+ '[' app = login ']'
+ SRC_ARGS='app wait learning-learnexp-i4eappservice-usw2-e2e --timeout 1800'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app wait learning-learnexp-i4eappservice-usw2-e2e --timeout 1800 --grpc-web
[Pipeline] echo
syncWPT: "argocd app wait" indicates healthy on first attempt - proceeding
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
{"eventType":"method_invocation","library_method":"gitOpsDeployRenderManifest","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"Deploy","build":"725","exception":"0","exceptionMessage":"","duration":"21785","timeStamp":"1713230338659","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
Lock released on resource [learning-learnexp-i4eappservice-usw2-e2e]
[Pipeline] // lock
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (prf-usw2-eks)
[Pipeline] lock
Trying to acquire lock on [learning-learnexp-i4eappservice-usw2-prf]
Resource [learning-learnexp-i4eappservice-usw2-prf] did not exist. Created.
Lock acquired on [learning-learnexp-i4eappservice-usw2-prf]
[Pipeline] {
[Pipeline] timeout
Timeout set to expire in 22 min
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Deploy)
[Pipeline] container
[Pipeline] {
[Pipeline] echo
FYI for restarting: version=null image_full_name=null restart_from_build=725 restart_chkpt_time=2024-04-16 01:18:59 (local)
[Pipeline] writeYaml
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] echo
Archived 'msaasConfig' in artifact: msaas-config_restart-archive.yaml
[Pipeline] echo
Committing manifest.
[Pipeline] withCredentials
Masking supported pattern matches of $USERNAME or $PASSWORD
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ date +%H:%M:%S.%N
01:18:59.651917104
+ uname -a
Linux futures-lea-lea-i4e-dep-master-v1.725-p1ksr-k5md5 5.4.268-181.368.amzn2.x86_64 #1 SMP Tue Jan 30 21:54:30 UTC 2024 x86_64 GNU/Linux
+ '[' '!' -f /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh ']'
++ whoami
+ echo 'User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists'
User root found /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh already exists
+ chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ echo 'Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh'
Succeeded; chmod +x /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
+ ls -l --full-time /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
-rwxr-xr-x. 1 appuser appuser 321 2024-04-16 01:15:37.012221047 +0000 /home/jenkins/agent/workspace/_i4eappservice-deployment_master/ask-pass.sh
[Pipeline] echo
IBP-12464 suggests the warning about insecure Groovy String interpolation here might be erroneous
[Pipeline] dir
Running in /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-prf-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce
[Pipeline] {
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential github-****
Warning: JENKINS-30600: special launcher org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator$1@25d7f6f7; decorates RemoteLauncher[hudson.remoting.Channel@49b3daf0:JNLP4-connect connection from ip-10-47-6-247.us-west-2.compute.internal/10.47.6.247:43022] will be ignored (a typical symptom is the Git executable not being run inside a designated container)
Cloning the remote Git repository
Cloning repository https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git init /home/jenkins/agent/workspace/_i4eappservice-deployment_master/deployment-prf-usw2-eks-1636d4387e16787e32e0e643e972dddf97a934ce # timeout=10
Fetching upstream changes from https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
 > git --version # timeout=10
 > git --version # 'git version 2.11.0'
using GIT_ASKPASS to set credentials github-****
 > git fetch --tags --progress -- https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
Checking out Revision 7f4dd597a309343dec520c3c8cf94ecc79d13886 (refs/remotes/origin/master-pending)
Commit message: "[Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]"
 > git config remote.origin.url https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master-pending^{commit} # timeout=10
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master-pending 7f4dd597a309343dec520c3c8cf94ecc79d13886 # timeout=10
[Pipeline] sh
++ git config --global user.email
+ result=MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
+ echo MSaaSServiceAccount@i4eappservice.learnexp.learning.a.intuit.com
[Pipeline] sh
++ git config --global user.name
+ result=MSaaSServiceAccount
+ echo MSaaSServiceAccount
[Pipeline] sh
+ git checkout 7f4dd597a309343dec520c3c8cf94ecc79d13886
Note: switching to '7f4dd597a309343dec520c3c8cf94ecc79d13886'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
[Pipeline] readFile
[Pipeline] sh
+ git fetch
[Pipeline] sh
+ git branch -r
[Pipeline] echo
branches: [origin/environments/e2e-usw2-eks, origin/environments/prd-usw2-eks, origin/environments/prf-usw2-eks, origin/environments/qal-usw2-eks, origin/environments/stg-usw2-eks, origin/klir_2023_12_04_16_18_16, origin/master, origin/master-pending, origin/neil-s3]
[Pipeline] sh
+ grep -v .git
+ ls -d environments .git '..?*'
+ xargs -I % rm -rf %
ls: cannot access '..?*': No such file or directory
[Pipeline] sh
+ rm -rf .gitpod.yml
[Pipeline] sh
+ git checkout environments/prf-usw2-eks --
Previous HEAD position was 7f4dd59 [Changed] - infrastructure deployment: [env=all, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
Switched to a new branch 'environments/prf-usw2-eks'
Branch 'environments/prf-usw2-eks' set up to track remote branch 'environments/prf-usw2-eks' from 'origin'.
[Pipeline] writeFile
[Pipeline] sh
+ git add manifest.yaml
[Pipeline] sh
+ git rev-parse --abbrev-ref HEAD
[Pipeline] sh
+ git status -s
+ wc -l
[Pipeline] sh
+ git commit -am '[Changed] - infrastructure deployment: [env=prf-usw2-eks, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]'
[environments/prf-usw2-eks 1da8fc4] [Changed] - infrastructure deployment: [env=prf-usw2-eks, jenkins_build=jenkins-learning-learnexp-i4eappservice-i4eappservice-deployment-master-725]
 1 file changed, 1 insertion(+), 1 deletion(-)
[Pipeline] lock
Trying to acquire lock on [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
Resource [github.intuit.com/learning-learnexp/i4eappservice-deployment.git] did not exist. Created.
Lock acquired on [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
[Pipeline] {
[Pipeline] timeout
Timeout set to expire in 10 min
[Pipeline] {
[Pipeline] sh
+ git pull --rebase https://****:****@github.intuit.com/learning-learnexp/i4eappservice-deployment.git environments/prf-usw2-eks
From https://github.intuit.com/learning-learnexp/i4eappservice-deployment
 * branch            environments/prf-usw2-eks -> FETCH_HEAD
Current branch environments/prf-usw2-eks is up to date.
[Pipeline] sh
+ git push https://****:****@github.intuit.com/learning-learnexp/i4eappservice-deployment.git environments/prf-usw2-eks
To https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
   0c4e4d3..1da8fc4  environments/prf-usw2-eks -> environments/prf-usw2-eks
[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
Lock released on resource [github.intuit.com/learning-learnexp/i4eappservice-deployment.git]
[Pipeline] // lock
[Pipeline] sh
+ git log '--format="%H"' -n 1
+ tail -n 1
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
Starting Argo sync.
[Pipeline] echo
Auto-Open CR: prf-usw2-eks is not prod. Skipping
[Pipeline] sh
+ echo running argocd sync with Project Token
running argocd sync with Project Token
[Pipeline] withCredentials
Masking supported pattern matches of $ARGOCD_AUTH_TOKEN
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] sh
+ /argocd --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-prf --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-prf --upsert --revision environments/prf-usw2-eks
+ '[' --server = login ']'
+ SRC_ARGS='--server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-prf --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-prf --upsert --revision environments/prf-usw2-eks'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli --server futures.argocd.tools-k8s-prd.a.intuit.com:443 app create --project learning-learnexp-i4eappservice --name learning-learnexp-i4eappservice-usw2-prf --repo https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git --path . --dest-server https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com --dest-namespace learning-learnexp-i4eappservice-usw2-prf --upsert --revision environments/prf-usw2-eks --grpc-web
application 'learning-learnexp-i4eappservice-usw2-prf' unchanged
[Pipeline] sh
+ /cd-guard all learning-learnexp-i4eappservice-usw2-prf
+ SRC_ARGS='all learning-learnexp-i4eappservice-usw2-prf'
+ [[ ! -f /tmp/cd-guard-cli ]]
+ ARGOCD_CONFIG=/root/.config/argocd/config
+ [[ -f /root/.config/argocd/config ]]
+ ARGOCD_CONFIG=/root/.argocd/config
+ [[ -f /root/.argocd/config ]]
+ echo 'ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config'
ArgoCD config can not be found in either /home/user/.config/argocd/config or ~/.argocd/config
+ /tmp/cd-guard-cli all learning-learnexp-i4eappservice-usw2-prf --grpc-web
time="2024-04-16T01:19:16Z" level=info msg="Ignore HPA minReplicas Check is "
time="2024-04-16T01:19:16Z" level=info msg="Ignore pod readineess gate Check is "
time="2024-04-16T01:19:17Z" level=info msg="The HorizontalPodAutoscaler:i4eappservice-rollout-hpa is associated with Rollout:i4eappservice-rollout"
time="2024-04-16T01:19:17Z" level=info msg="Rollout:i4eappservice-rollout doesn't have 'spec.replicas', it is managed by HPA, perfect!"
[Pipeline] sh
+ /argocd app sync learning-learnexp-i4eappservice-usw2-prf
+ '[' app = login ']'
+ SRC_ARGS='app sync learning-learnexp-i4eappservice-usw2-prf'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app sync learning-learnexp-i4eappservice-usw2-prf --grpc-web
TIMESTAMP                  GROUP                          KIND                NAMESPACE                                                NAME                     STATUS    HEALTH         HOOK  MESSAGE
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-error-rate                 Synced                         
2024-04-16T01:19:18+00:00  autoscaling              HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-hpa                Synced   Healthy               
2024-04-16T01:19:18+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-root-service               Synced   Healthy               
2024-04-16T01:19:18+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-stable-service             Synced   Healthy               
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-request-latency            Synced                         
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate-include4xx    Synced                         
2024-04-16T01:19:18+00:00  iammanager.keikoproj.io     Iamrole               learning-learnexp-i4eappservice-usw2-prf               iamrole                     Synced   Healthy               
2024-04-16T01:19:18+00:00  policy                   PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-prf     i4eappservice-pdb                     Synced                         
2024-04-16T01:19:18+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-service-metrics            Synced   Healthy               
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-memory-utilization         Synced                         
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pod-restarts               Synced                         
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate               Synced                         
2024-04-16T01:19:18+00:00  argoproj.io                 Rollout               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout                  OutOfSync  Degraded              
2024-04-16T01:19:18+00:00  networking.k8s.io           Ingress               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-ingress            Synced   Healthy               
2024-04-16T01:19:18+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-desired-service            Synced   Healthy               
2024-04-16T01:19:18+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-cpu-utilization            Synced                         
2024-04-16T01:19:20+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-prf               iamrole    Synced  Healthy              iamrole.iammanager.keikoproj.io/iamrole unchanged
2024-04-16T01:19:23+00:00  networking.k8s.io           Ingress  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-ingress    Synced  Healthy              ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
2024-04-16T01:19:23+00:00  iammanager.keikoproj.io     Iamrole  learning-learnexp-i4eappservice-usw2-prf               iamrole             Synced  Healthy              Role 'k8s-learning-learnexp-i4eappservice-usw2-prf' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-prf' and ID 'AROAQALN7OYFFB3ZEXDRQ'.
2024-04-16T01:19:24+00:00  argoproj.io     Rollout               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout                  OutOfSync  Degraded              rollout.argoproj.io/i4eappservice-rollout configured
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate-include4xx    Synced                         analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
2024-04-16T01:19:24+00:00                  Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-desired-service            Synced   Healthy               service/i4eappservice-desired-service unchanged
2024-04-16T01:19:24+00:00  autoscaling  HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-hpa                Synced   Healthy               horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pod-restarts               Synced                         analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-memory-utilization         Synced                         analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
2024-04-16T01:19:24+00:00                  Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-stable-service             Synced   Healthy               service/i4eappservice-stable-service unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-error-rate                 Synced                         analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-request-latency            Synced                         analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate               Synced                         analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
2024-04-16T01:19:24+00:00  policy       PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-prf     i4eappservice-pdb                     Synced                         poddisruptionbudget.policy/i4eappservice-pdb configured
2024-04-16T01:19:24+00:00                  Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-root-service               Synced   Healthy               service/i4eappservice-root-service unchanged
2024-04-16T01:19:24+00:00                  Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-service-metrics            Synced   Healthy               service/i4eappservice-service-metrics unchanged
2024-04-16T01:19:24+00:00  argoproj.io  AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-cpu-utilization            Synced                         analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
2024-04-16T01:19:24+00:00  argoproj.io     Rollout  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout    Synced  Progressing              rollout.argoproj.io/i4eappservice-rollout configured

Name:               dev-argocd-usw2-futu/learning-learnexp-i4eappservice-usw2-prf
Project:            learning-learnexp-i4eappservice
Server:             https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com
Namespace:          learning-learnexp-i4eappservice-usw2-prf
URL:                https://futures.argocd.tools-k8s-prd.a.intuit.com/applications/learning-learnexp-i4eappservice-usw2-prf
Repo:               https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
Target:             environments/prf-usw2-eks
Path:               .
SyncWindow:         Sync Allowed
Sync Policy:        <none>
Sync Status:        Synced to environments/prf-usw2-eks (1da8fc4)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      1da8fc409cc5fc3d1e3949b7e0d0d49f948a1401
Phase:              Succeeded
Start:              2024-04-16 01:19:18 +0000 UTC
Finished:           2024-04-16 01:19:24 +0000 UTC
Duration:           6s
Message:            successfully synced (all tasks run)

GROUP                    KIND                     NAMESPACE                                 NAME                                   STATUS  HEALTH       HOOK  MESSAGE
iammanager.keikoproj.io  Iamrole                  learning-learnexp-i4eappservice-usw2-prf  iamrole                                Synced  Healthy            Role 'k8s-learning-learnexp-i4eappservice-usw2-prf' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-prf' and ID 'AROAQALN7OYFFB3ZEXDRQ'.
networking.k8s.io        Ingress                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-ingress          Synced  Healthy            ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
policy                   PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pdb                      Synced                     poddisruptionbudget.policy/i4eappservice-pdb configured
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-desired-service          Synced  Healthy            service/i4eappservice-desired-service unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-root-service             Synced  Healthy            service/i4eappservice-root-service unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-service-metrics          Synced  Healthy            service/i4eappservice-service-metrics unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-stable-service           Synced  Healthy            service/i4eappservice-stable-service unchanged
autoscaling              HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-hpa              Synced  Healthy            horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pod-restarts             Synced                     analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-memory-utilization       Synced                     analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-error-rate               Synced                     analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-request-latency          Synced                     analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-cpu-utilization          Synced                     analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
argoproj.io              Rollout                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout                  Synced  Progressing        rollout.argoproj.io/i4eappservice-rollout configured
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate-include4xx  Synced                     analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate             Synced                     analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
[Pipeline] sh
+ /argocd app manifests learning-learnexp-i4eappservice-usw2-prf
+ '[' app = login ']'
+ SRC_ARGS='app manifests learning-learnexp-i4eappservice-usw2-prf'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app manifests learning-learnexp-i4eappservice-usw2-prf --grpc-web
[Pipeline] readYaml
[Pipeline] sh
+ /argocd app wait learning-learnexp-i4eappservice-usw2-prf --timeout 1800
+ '[' app = login ']'
+ SRC_ARGS='app wait learning-learnexp-i4eappservice-usw2-prf --timeout 1800'
+ '[' '!' -f /tmp/argocd-cli ']'
+ /tmp/argocd-cli app wait learning-learnexp-i4eappservice-usw2-prf --timeout 1800 --grpc-web
time="2024-04-16T01:29:25Z" level=fatal msg="application 'learning-learnexp-i4eappservice-usw2-prf' health state has transitioned from Progressing to Degraded"
TIMESTAMP                  GROUP                          KIND                NAMESPACE                                                NAME                     STATUS   HEALTH            HOOK  MESSAGE
2024-04-16T01:19:28+00:00  policy                   PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-prf     i4eappservice-pdb                     Synced                           poddisruptionbudget.policy/i4eappservice-pdb configured
2024-04-16T01:19:28+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-root-service               Synced  Healthy                  service/i4eappservice-root-service unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-memory-utilization         Synced                           analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-error-rate                 Synced                           analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-cpu-utilization            Synced                           analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
2024-04-16T01:19:28+00:00  iammanager.keikoproj.io     Iamrole               learning-learnexp-i4eappservice-usw2-prf               iamrole                     Synced  Healthy                  Role 'k8s-learning-learnexp-i4eappservice-usw2-prf' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-prf' and ID 'AROAQALN7OYFFB3ZEXDRQ'.
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pod-restarts               Synced                           analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate               Synced                           analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
2024-04-16T01:19:28+00:00  networking.k8s.io           Ingress               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-ingress            Synced  Healthy                  ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
2024-04-16T01:19:28+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-service-metrics            Synced  Healthy                  service/i4eappservice-service-metrics unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-request-latency            Synced                           analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
2024-04-16T01:19:28+00:00  argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate-include4xx    Synced                           analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
2024-04-16T01:19:28+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-desired-service            Synced  Healthy                  service/i4eappservice-desired-service unchanged
2024-04-16T01:19:28+00:00                              Service               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-stable-service             Synced  Healthy                  service/i4eappservice-stable-service unchanged
2024-04-16T01:19:28+00:00  autoscaling              HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-hpa                Synced  Healthy                  horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
2024-04-16T01:19:28+00:00  argoproj.io                 Rollout               learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout                    Synced  Progressing              rollout.argoproj.io/i4eappservice-rollout configured

Name:               dev-argocd-usw2-futu/learning-learnexp-i4eappservice-usw2-prf
Project:            learning-learnexp-i4eappservice
Server:             https://eksapi-futures-ppd-usw2-k8s-8016650e6946143a.elb.us-west-2.amazonaws.com
Namespace:          learning-learnexp-i4eappservice-usw2-prf
URL:                https://futures.argocd.tools-k8s-prd.a.intuit.com/applications/learning-learnexp-i4eappservice-usw2-prf
Repo:               https://github.intuit.com/learning-learnexp/i4eappservice-deployment.git
Target:             environments/prf-usw2-eks
Path:               .
SyncWindow:         Sync Allowed
Sync Policy:        <none>
Sync Status:        Synced to environments/prf-usw2-eks (1da8fc4)
Health Status:      Degraded

Operation:          Sync
Sync Revision:      1da8fc409cc5fc3d1e3949b7e0d0d49f948a1401
Phase:              Succeeded
Start:              2024-04-16 01:19:18 +0000 UTC
Finished:           2024-04-16 01:19:24 +0000 UTC
Duration:           6s
Message:            successfully synced (all tasks run)

GROUP                    KIND                     NAMESPACE                                 NAME                                   STATUS  HEALTH    HOOK  MESSAGE
iammanager.keikoproj.io  Iamrole                  learning-learnexp-i4eappservice-usw2-prf  iamrole                                Synced  Healthy         Role 'k8s-learning-learnexp-i4eappservice-usw2-prf' exists with ARN 'arn:aws:iam::000767522314:role/k8s-learning-learnexp-i4eappservice-usw2-prf' and ID 'AROAQALN7OYFFB3ZEXDRQ'.
networking.k8s.io        Ingress                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-ingress          Synced  Healthy         ingress.networking.k8s.io/i4eappservice-rollout-ingress unchanged
policy                   PodDisruptionBudget      learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pdb                      Synced                  poddisruptionbudget.policy/i4eappservice-pdb configured
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-desired-service          Synced  Healthy         service/i4eappservice-desired-service unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-root-service             Synced  Healthy         service/i4eappservice-root-service unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-service-metrics          Synced  Healthy         service/i4eappservice-service-metrics unchanged
                         Service                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-stable-service           Synced  Healthy         service/i4eappservice-stable-service unchanged
autoscaling              HorizontalPodAutoscaler  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout-hpa              Synced  Healthy         horizontalpodautoscaler.autoscaling/i4eappservice-rollout-hpa unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-pod-restarts             Synced                  analysistemplate.argoproj.io/i4eappservice-pod-restarts unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-memory-utilization       Synced                  analysistemplate.argoproj.io/i4eappservice-memory-utilization unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-error-rate               Synced                  analysistemplate.argoproj.io/i4eappservice-error-rate unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-request-latency          Synced                  analysistemplate.argoproj.io/i4eappservice-request-latency unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-cpu-utilization          Synced                  analysistemplate.argoproj.io/i4eappservice-cpu-utilization unchanged
argoproj.io              Rollout                  learning-learnexp-i4eappservice-usw2-prf  i4eappservice-rollout                  Synced  Degraded        rollout.argoproj.io/i4eappservice-rollout configured
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate-include4xx  Synced                  analysistemplate.argoproj.io/i4eappservice-success-rate-include4xx unchanged
argoproj.io              AnalysisTemplate         learning-learnexp-i4eappservice-usw2-prf  i4eappservice-success-rate             Synced                  analysistemplate.argoproj.io/i4eappservice-success-rate unchanged
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
{"eventType":"method_invocation","library_method":"gitOpsDeployRenderManifest","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"Deploy","build":"725","exception":"1","exceptionMessage":"hudson.AbortException: script returned exit code 20","duration":"636225","timeStamp":"1713230975342","buildResult":"null","buildCurrentResult":"SUCCESS","assetId":"2597468678172884775"}
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
Lock released on resource [learning-learnexp-i4eappservice-usw2-prf]
[Pipeline] // lock
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (stg-usw2-eks)
Stage "stg-usw2-eks" skipped due to earlier failure(s)
[Pipeline] stage
[Pipeline] { (Deploy)
Stage "stg-usw2-eks" skipped due to earlier failure(s)
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Go Live in Prod Approval)
Stage "Go Live in Prod Approval" skipped due to earlier failure(s)
[Pipeline] stage
[Pipeline] { (Scorecard Check)
Stage "Go Live in Prod Approval" skipped due to earlier failure(s)
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (PRD primary)
Stage "PRD primary" skipped due to earlier failure(s)
[Pipeline] stage
[Pipeline] { (Create CR)
Stage "PRD primary" skipped due to earlier failure(s)
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy)
Stage "PRD primary" skipped due to earlier failure(s)
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Close CR)
Stage "PRD primary" skipped due to earlier failure(s)
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] withCredentials
Masking supported pattern matches of $API_KEY
[Pipeline] {
[Pipeline] reportPipelineMetrics
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] echo
{"eventType":"method_invocation","library_method":"sendMetrics","buildUrl":"https://build.intuit.com/futures/job/learning-learnexp/job/i4eappservice/job/i4eappservice-deployment/job/master/725/","jobName":"learning-learnexp/i4eappservice/i4eappservice-deployment/master","stage":"Declarative: Post Actions","build":"725","exception":"0","exceptionMessage":"","duration":"596","timeStamp":"1713230977073","buildResult":"FAILURE","buildCurrentResult":"FAILURE","assetId":"2597468678172884775"}
[Pipeline] emailext
Sending email to: some_email@intuit.com
Not sent to the following valid addresses: some_email@intuit.com
[Pipeline] slackSend
Slack Send Pipeline step running, values are - baseUrl: <empty>, teamDomain: intuit-teams, channel: #i4e-dev-ops, color: #b50911, botUser: false, tokenCredentialId: slack-ke-extensions, notifyCommitters: false, iconEmoji: <empty>, username: <empty>, timestamp: <empty>
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // podTemplate
[Pipeline] End of Pipeline
ERROR: script returned exit code 20

GitHub has been notified of this commit’s build result

Finished: FAILURE
